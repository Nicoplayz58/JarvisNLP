

<!DOCTYPE html>


<html lang="en" data-content_root="" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

    <title>W2V + BilSTM &#8212; Procesamiento del Lenguaje Natural - Jarvis Calling Contest</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="_static/styles/theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="_static/styles/bootstrap.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="_static/styles/pydata-sphinx-theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />

  
  <link href="_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" href="_static/styles/sphinx-book-theme.css?digest=14f4ca6b54d191a8c7657f6c759bf11a5fb86285" type="text/css" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="_static/design-style.4045f2051d55cab465a707391d5b2007.min.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b" />
<link rel="preload" as="script" href="_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b" />
  <script src="_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=dfe6caa3a7d634c4db9b"></script>

    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/clipboard.min.js"></script>
    <script src="_static/copybutton.js"></script>
    <script src="_static/scripts/sphinx-book-theme.js?digest=5a5c038af52cf7bc1a1ec88eea08e6366ee68824"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="_static/sphinx-thebe.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'TF_models';</script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="InterpretaciÃ³n general" href="Resultados.html" />
    <link rel="prev" title="Modelo: Transformers (DistilBERT o RoBERTa)" href="DistilBERT.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="intro.html">
  
  
  
  
  
    
    
      
    
    
    <img src="_static/logo.png" class="logo__image only-light" alt="Procesamiento del Lenguaje Natural - Jarvis Calling Contest - Home"/>
    <script>document.write(`<img src="_static/logo.png" class="logo__image only-dark" alt="Procesamiento del Lenguaje Natural - Jarvis Calling Contest - Home"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item"><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="intro.html">
                    Procesamiento del Lenguaje Natural: Jarvis Calling Hiring Contest
                </a>
            </li>
        </ul>
        <ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="eda.html">Exploratory Data Analysis</a></li>
<li class="toctree-l1"><a class="reference internal" href="DistilBERT.html">Modelo: Transformers (DistilBERT o RoBERTa)</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">W2V + BilSTM</a></li>



<li class="toctree-l1"><a class="reference internal" href="Resultados.html">InterpretaciÃ³n general</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/nicoplayz58/jarvis-nlp-book" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/nicoplayz58/jarvis-nlp-book/issues/new?title=Issue%20on%20page%20%2FTF_models.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="_sources/TF_models.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="theme-switch fa-solid fa-sun fa-lg" data-mode="light"></i>
    <i class="theme-switch fa-solid fa-moon fa-lg" data-mode="dark"></i>
    <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"></i>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm pst-navbar-icon search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>W2V + BilSTM</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#">W2V + BilSTM</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#cnn-1d-con-embeddings">CNN-1D con Embeddings</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#tf-idf-xgboost-con-gpu">TF-IDF + XGBoost con GPU</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#fast-text-con-entrenamiento-local">FAST TEXT con entrenamiento local</a></li>
</ul>

            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="w2v-bilstm">
<h1>W2V + BilSTM<a class="headerlink" href="#w2v-bilstm" title="Permalink to this heading">#</a></h1>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">os</span><span class="o">,</span><span class="w"> </span><span class="nn">re</span><span class="o">,</span><span class="w"> </span><span class="nn">time</span><span class="o">,</span><span class="w"> </span><span class="nn">random</span><span class="o">,</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span><span class="o">,</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">tensorflow</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">tf</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">sklearn.model_selection</span><span class="w"> </span><span class="kn">import</span> <span class="n">train_test_split</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">sklearn.preprocessing</span><span class="w"> </span><span class="kn">import</span> <span class="n">LabelEncoder</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">sklearn.metrics</span><span class="w"> </span><span class="kn">import</span> <span class="n">accuracy_score</span><span class="p">,</span> <span class="n">precision_score</span><span class="p">,</span> <span class="n">recall_score</span><span class="p">,</span> <span class="n">f1_score</span><span class="p">,</span> <span class="n">confusion_matrix</span><span class="p">,</span> <span class="n">classification_report</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">seaborn</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">sns</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">nltk</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">nltk.corpus</span><span class="w"> </span><span class="kn">import</span> <span class="n">stopwords</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">nltk.tokenize</span><span class="w"> </span><span class="kn">import</span> <span class="n">word_tokenize</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">gensim.downloader</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">api</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">tensorflow.keras.preprocessing.text</span><span class="w"> </span><span class="kn">import</span> <span class="n">Tokenizer</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">tensorflow.keras.preprocessing.sequence</span><span class="w"> </span><span class="kn">import</span> <span class="n">pad_sequences</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">tensorflow.keras.models</span><span class="w"> </span><span class="kn">import</span> <span class="n">Sequential</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">tensorflow.keras.layers</span><span class="w"> </span><span class="kn">import</span> <span class="n">Embedding</span><span class="p">,</span> <span class="n">Bidirectional</span><span class="p">,</span> <span class="n">LSTM</span><span class="p">,</span> <span class="n">Dropout</span><span class="p">,</span> <span class="n">Dense</span><span class="p">,</span> <span class="n">BatchNormalization</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">tensorflow.keras.callbacks</span><span class="w"> </span><span class="kn">import</span> <span class="n">EarlyStopping</span><span class="p">,</span> <span class="n">ReduceLROnPlateau</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">tensorflow.keras.optimizers</span><span class="w"> </span><span class="kn">import</span> <span class="n">Adam</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-11-06 16:24:41.890989: I tensorflow/core/util/port.cc:153] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2025-11-06 16:24:41.931421: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX_VNNI, in other operations, rebuild TensorFlow with the appropriate compiler flags.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-11-06 16:24:47.269101: I tensorflow/core/util/port.cc:153] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">PATH</span> <span class="o">=</span> <span class="s2">&quot;dataset_EDA_completo.csv&quot;</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">PATH</span><span class="p">)</span>

<span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[[</span><span class="s1">&#39;clean_text&#39;</span><span class="p">,</span> <span class="s1">&#39;category&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;clean_text&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">len</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

<span class="n">le</span> <span class="o">=</span> <span class="n">LabelEncoder</span><span class="p">()</span>
<span class="n">df</span><span class="p">[</span><span class="s1">&#39;y&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">le</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;category&#39;</span><span class="p">])</span>
<span class="n">num_classes</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;y&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">nunique</span><span class="p">()</span>

<span class="n">X_train</span><span class="p">,</span> <span class="n">X_tmp</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">y_tmp</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span>
    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;clean_text&#39;</span><span class="p">],</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;y&#39;</span><span class="p">],</span> <span class="n">test_size</span><span class="o">=</span><span class="mf">0.30</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="n">SEED</span><span class="p">,</span> <span class="n">stratify</span><span class="o">=</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;y&#39;</span><span class="p">]</span>
<span class="p">)</span>
<span class="n">X_val</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_val</span><span class="p">,</span> <span class="n">y_test</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span>
    <span class="n">X_tmp</span><span class="p">,</span> <span class="n">y_tmp</span><span class="p">,</span> <span class="n">test_size</span><span class="o">=</span><span class="mf">0.50</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="n">SEED</span><span class="p">,</span> <span class="n">stratify</span><span class="o">=</span><span class="n">y_tmp</span>
<span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Train: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">X_train</span><span class="p">)</span><span class="si">}</span><span class="s2"> | Val: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">X_val</span><span class="p">)</span><span class="si">}</span><span class="s2"> | Test: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span><span class="si">}</span><span class="s2"> | Clases: </span><span class="si">{</span><span class="n">num_classes</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">FileNotFoundError</span><span class="g g-Whitespace">                         </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">line</span> <span class="mi">2</span>
<span class="g g-Whitespace">      </span><span class="mi">1</span> <span class="n">PATH</span> <span class="o">=</span> <span class="s2">&quot;dataset_EDA_completo.csv&quot;</span>
<span class="ne">----&gt; </span><span class="mi">2</span> <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">PATH</span><span class="p">)</span>
<span class="g g-Whitespace">      </span><span class="mi">4</span> <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[[</span><span class="s1">&#39;clean_text&#39;</span><span class="p">,</span> <span class="s1">&#39;category&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>
<span class="g g-Whitespace">      </span><span class="mi">5</span> <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;clean_text&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">len</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

<span class="nn">File ~/tf312/lib/python3.12/site-packages/pandas/io/parsers/readers.py:1026,</span> in <span class="ni">read_csv</span><span class="nt">(filepath_or_buffer, sep, delimiter, header, names, index_col, usecols, dtype, engine, converters, true_values, false_values, skipinitialspace, skiprows, skipfooter, nrows, na_values, keep_default_na, na_filter, verbose, skip_blank_lines, parse_dates, infer_datetime_format, keep_date_col, date_parser, date_format, dayfirst, cache_dates, iterator, chunksize, compression, thousands, decimal, lineterminator, quotechar, quoting, doublequote, escapechar, comment, encoding, encoding_errors, dialect, on_bad_lines, delim_whitespace, low_memory, memory_map, float_precision, storage_options, dtype_backend)</span>
<span class="g g-Whitespace">   </span><span class="mi">1013</span> <span class="n">kwds_defaults</span> <span class="o">=</span> <span class="n">_refine_defaults_read</span><span class="p">(</span>
<span class="g g-Whitespace">   </span><span class="mi">1014</span>     <span class="n">dialect</span><span class="p">,</span>
<span class="g g-Whitespace">   </span><span class="mi">1015</span>     <span class="n">delimiter</span><span class="p">,</span>
   <span class="p">(</span><span class="o">...</span><span class="p">)</span>   <span class="mi">1022</span>     <span class="n">dtype_backend</span><span class="o">=</span><span class="n">dtype_backend</span><span class="p">,</span>
<span class="g g-Whitespace">   </span><span class="mi">1023</span> <span class="p">)</span>
<span class="g g-Whitespace">   </span><span class="mi">1024</span> <span class="n">kwds</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">kwds_defaults</span><span class="p">)</span>
<span class="ne">-&gt; </span><span class="mi">1026</span> <span class="k">return</span> <span class="n">_read</span><span class="p">(</span><span class="n">filepath_or_buffer</span><span class="p">,</span> <span class="n">kwds</span><span class="p">)</span>

<span class="nn">File ~/tf312/lib/python3.12/site-packages/pandas/io/parsers/readers.py:620,</span> in <span class="ni">_read</span><span class="nt">(filepath_or_buffer, kwds)</span>
<span class="g g-Whitespace">    </span><span class="mi">617</span> <span class="n">_validate_names</span><span class="p">(</span><span class="n">kwds</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;names&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">))</span>
<span class="g g-Whitespace">    </span><span class="mi">619</span> <span class="c1"># Create the parser.</span>
<span class="ne">--&gt; </span><span class="mi">620</span> <span class="n">parser</span> <span class="o">=</span> <span class="n">TextFileReader</span><span class="p">(</span><span class="n">filepath_or_buffer</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">622</span> <span class="k">if</span> <span class="n">chunksize</span> <span class="ow">or</span> <span class="n">iterator</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">623</span>     <span class="k">return</span> <span class="n">parser</span>

<span class="nn">File ~/tf312/lib/python3.12/site-packages/pandas/io/parsers/readers.py:1620,</span> in <span class="ni">TextFileReader.__init__</span><span class="nt">(self, f, engine, **kwds)</span>
<span class="g g-Whitespace">   </span><span class="mi">1617</span>     <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="s2">&quot;has_index_names&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwds</span><span class="p">[</span><span class="s2">&quot;has_index_names&quot;</span><span class="p">]</span>
<span class="g g-Whitespace">   </span><span class="mi">1619</span> <span class="bp">self</span><span class="o">.</span><span class="n">handles</span><span class="p">:</span> <span class="n">IOHandles</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
<span class="ne">-&gt; </span><span class="mi">1620</span> <span class="bp">self</span><span class="o">.</span><span class="n">_engine</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_make_engine</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">engine</span><span class="p">)</span>

<span class="nn">File ~/tf312/lib/python3.12/site-packages/pandas/io/parsers/readers.py:1880,</span> in <span class="ni">TextFileReader._make_engine</span><span class="nt">(self, f, engine)</span>
<span class="g g-Whitespace">   </span><span class="mi">1878</span>     <span class="k">if</span> <span class="s2">&quot;b&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">mode</span><span class="p">:</span>
<span class="g g-Whitespace">   </span><span class="mi">1879</span>         <span class="n">mode</span> <span class="o">+=</span> <span class="s2">&quot;b&quot;</span>
<span class="ne">-&gt; </span><span class="mi">1880</span> <span class="bp">self</span><span class="o">.</span><span class="n">handles</span> <span class="o">=</span> <span class="n">get_handle</span><span class="p">(</span>
<span class="g g-Whitespace">   </span><span class="mi">1881</span>     <span class="n">f</span><span class="p">,</span>
<span class="g g-Whitespace">   </span><span class="mi">1882</span>     <span class="n">mode</span><span class="p">,</span>
<span class="g g-Whitespace">   </span><span class="mi">1883</span>     <span class="n">encoding</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;encoding&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
<span class="g g-Whitespace">   </span><span class="mi">1884</span>     <span class="n">compression</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;compression&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
<span class="g g-Whitespace">   </span><span class="mi">1885</span>     <span class="n">memory_map</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;memory_map&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">),</span>
<span class="g g-Whitespace">   </span><span class="mi">1886</span>     <span class="n">is_text</span><span class="o">=</span><span class="n">is_text</span><span class="p">,</span>
<span class="g g-Whitespace">   </span><span class="mi">1887</span>     <span class="n">errors</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;encoding_errors&quot;</span><span class="p">,</span> <span class="s2">&quot;strict&quot;</span><span class="p">),</span>
<span class="g g-Whitespace">   </span><span class="mi">1888</span>     <span class="n">storage_options</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;storage_options&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
<span class="g g-Whitespace">   </span><span class="mi">1889</span> <span class="p">)</span>
<span class="g g-Whitespace">   </span><span class="mi">1890</span> <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">handles</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
<span class="g g-Whitespace">   </span><span class="mi">1891</span> <span class="n">f</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">handles</span><span class="o">.</span><span class="n">handle</span>

<span class="nn">File ~/tf312/lib/python3.12/site-packages/pandas/io/common.py:873,</span> in <span class="ni">get_handle</span><span class="nt">(path_or_buf, mode, encoding, compression, memory_map, is_text, errors, storage_options)</span>
<span class="g g-Whitespace">    </span><span class="mi">868</span> <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">handle</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
<span class="g g-Whitespace">    </span><span class="mi">869</span>     <span class="c1"># Check whether the filename is to be opened in binary mode.</span>
<span class="g g-Whitespace">    </span><span class="mi">870</span>     <span class="c1"># Binary mode does not support &#39;encoding&#39; and &#39;newline&#39;.</span>
<span class="g g-Whitespace">    </span><span class="mi">871</span>     <span class="k">if</span> <span class="n">ioargs</span><span class="o">.</span><span class="n">encoding</span> <span class="ow">and</span> <span class="s2">&quot;b&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">ioargs</span><span class="o">.</span><span class="n">mode</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">872</span>         <span class="c1"># Encoding</span>
<span class="ne">--&gt; </span><span class="mi">873</span>         <span class="n">handle</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span>
<span class="g g-Whitespace">    </span><span class="mi">874</span>             <span class="n">handle</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">875</span>             <span class="n">ioargs</span><span class="o">.</span><span class="n">mode</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">876</span>             <span class="n">encoding</span><span class="o">=</span><span class="n">ioargs</span><span class="o">.</span><span class="n">encoding</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">877</span>             <span class="n">errors</span><span class="o">=</span><span class="n">errors</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">878</span>             <span class="n">newline</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">879</span>         <span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">880</span>     <span class="k">else</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">881</span>         <span class="c1"># Binary mode</span>
<span class="g g-Whitespace">    </span><span class="mi">882</span>         <span class="n">handle</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">handle</span><span class="p">,</span> <span class="n">ioargs</span><span class="o">.</span><span class="n">mode</span><span class="p">)</span>

<span class="ne">FileNotFoundError</span>: [Errno 2] No such file or directory: &#39;dataset_EDA_completo.csv&#39;
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">nltk</span><span class="o">.</span><span class="n">download</span><span class="p">(</span><span class="s1">&#39;punkt_tab&#39;</span><span class="p">,</span> <span class="n">quiet</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">nltk</span><span class="o">.</span><span class="n">download</span><span class="p">(</span><span class="s1">&#39;stopwords&#39;</span><span class="p">,</span> <span class="n">quiet</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">STOPWORDS</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">stopwords</span><span class="o">.</span><span class="n">words</span><span class="p">(</span><span class="s2">&quot;english&quot;</span><span class="p">))</span>

<span class="k">def</span><span class="w"> </span><span class="nf">clean_text</span><span class="p">(</span><span class="n">text</span><span class="p">):</span>
    <span class="n">text</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;http\S+|www\S+&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">text</span><span class="p">)</span>
    <span class="n">text</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;[^a-zA-Z&#39;]&quot;</span><span class="p">,</span> <span class="s2">&quot; &quot;</span><span class="p">,</span> <span class="n">text</span><span class="o">.</span><span class="n">lower</span><span class="p">())</span>
    <span class="n">tokens</span> <span class="o">=</span> <span class="n">word_tokenize</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">t</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">tokens</span> <span class="k">if</span> <span class="n">t</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">STOPWORDS</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">t</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">]</span>

<span class="n">sentences</span> <span class="o">=</span> <span class="p">[</span><span class="n">clean_text</span><span class="p">(</span><span class="n">t</span><span class="p">)</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;clean_text&#39;</span><span class="p">]]</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;âœ… Ejemplo de tokens:&quot;</span><span class="p">,</span> <span class="n">sentences</span><span class="p">[</span><span class="mi">0</span><span class="p">][:</span><span class="mi">10</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>âœ… Ejemplo de tokens: [&#39;accountant&#39;, &#39;summary&#39;, &#39;financial&#39;, &#39;accountant&#39;, &#39;specializing&#39;, &#39;financial&#39;, &#39;planning&#39;, &#39;reporting&#39;, &#39;analysis&#39;, &#39;within&#39;]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">gensim.models</span><span class="w"> </span><span class="kn">import</span> <span class="n">KeyedVectors</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;ðŸ”¹ Cargando modelo FastText (crawl-300d-2M-subword.vec)...&quot;</span><span class="p">)</span>
<span class="n">path</span> <span class="o">=</span> <span class="s2">&quot;/home/nicoplayz/Deep Learning/LLM/Jarvis Calling Hiring Contest/crawl-300d-2M-subword.vec&quot;</span>

<span class="n">w2v_model</span> <span class="o">=</span> <span class="n">KeyedVectors</span><span class="o">.</span><span class="n">load_word2vec_format</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">binary</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">EMB_DIM</span> <span class="o">=</span> <span class="mi">300</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;âœ… Modelo cargado: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">w2v_model</span><span class="o">.</span><span class="n">key_to_index</span><span class="p">)</span><span class="si">}</span><span class="s2"> palabras.&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>ðŸ”¹ Cargando modelo FastText (crawl-300d-2M-subword.vec)...
âœ… Modelo cargado: 2000000 palabras.
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">embedding_matrix</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">vocab_size</span><span class="p">,</span> <span class="n">EMB_DIM</span><span class="p">))</span>
<span class="n">found</span> <span class="o">=</span> <span class="mi">0</span>
<span class="k">for</span> <span class="n">word</span><span class="p">,</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">tokenizer</span><span class="o">.</span><span class="n">word_index</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="k">if</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">w2v_model</span><span class="o">.</span><span class="n">key_to_index</span><span class="p">:</span>
        <span class="n">embedding_matrix</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">w2v_model</span><span class="p">[</span><span class="n">word</span><span class="p">]</span>
        <span class="n">found</span> <span class="o">+=</span> <span class="mi">1</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;âœ… Palabras cubiertas: </span><span class="si">{</span><span class="n">found</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">vocab_size</span><span class="si">}</span><span class="s2"> (</span><span class="si">{</span><span class="n">found</span><span class="o">/</span><span class="n">vocab_size</span><span class="o">*</span><span class="mi">100</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">%)&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>âœ… Palabras cubiertas: 27714/40647 (68.2%)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">embedding_matrix</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">vocab_size</span><span class="p">,</span> <span class="n">EMB_DIM</span><span class="p">))</span>
<span class="n">found</span> <span class="o">=</span> <span class="mi">0</span>

<span class="k">for</span> <span class="n">word</span><span class="p">,</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">tokenizer</span><span class="o">.</span><span class="n">word_index</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="k">if</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">w2v_model</span><span class="o">.</span><span class="n">key_to_index</span><span class="p">:</span>
        <span class="n">embedding_matrix</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">w2v_model</span><span class="p">[</span><span class="n">word</span><span class="p">]</span>
        <span class="n">found</span> <span class="o">+=</span> <span class="mi">1</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;âœ… Palabras con embeddings encontrados: </span><span class="si">{</span><span class="n">found</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">vocab_size</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>âœ… Palabras con embeddings encontrados: 23324/40647
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">tensorflow.keras.models</span><span class="w"> </span><span class="kn">import</span> <span class="n">Sequential</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">tensorflow.keras.layers</span><span class="w"> </span><span class="kn">import</span> <span class="n">Embedding</span><span class="p">,</span> <span class="n">Bidirectional</span><span class="p">,</span> <span class="n">LSTM</span><span class="p">,</span> <span class="n">Dropout</span><span class="p">,</span> <span class="n">Dense</span><span class="p">,</span> <span class="n">BatchNormalization</span><span class="p">,</span> <span class="n">SpatialDropout1D</span><span class="p">,</span> <span class="n">LeakyReLU</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">tensorflow.keras.optimizers</span><span class="w"> </span><span class="kn">import</span> <span class="n">Adam</span>

<span class="k">def</span><span class="w"> </span><span class="nf">build_bilstm</span><span class="p">(</span><span class="n">vocab_size</span><span class="p">,</span> <span class="n">emb_dim</span><span class="p">,</span> <span class="n">embedding_matrix</span><span class="p">,</span> <span class="n">sequence_length</span><span class="p">,</span> <span class="n">num_classes</span><span class="p">):</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">Sequential</span><span class="p">([</span>
        <span class="n">Embedding</span><span class="p">(</span><span class="n">vocab_size</span><span class="p">,</span> <span class="n">emb_dim</span><span class="p">,</span> <span class="n">weights</span><span class="o">=</span><span class="p">[</span><span class="n">embedding_matrix</span><span class="p">],</span>
                  <span class="n">input_length</span><span class="o">=</span><span class="n">sequence_length</span><span class="p">,</span> <span class="n">trainable</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
        <span class="n">SpatialDropout1D</span><span class="p">(</span><span class="mf">0.2</span><span class="p">),</span>
        <span class="n">Bidirectional</span><span class="p">(</span><span class="n">LSTM</span><span class="p">(</span><span class="mi">128</span><span class="p">,</span> <span class="n">return_sequences</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">recurrent_dropout</span><span class="o">=</span><span class="mf">0.2</span><span class="p">)),</span>
        <span class="n">BatchNormalization</span><span class="p">(),</span>
        <span class="n">Dropout</span><span class="p">(</span><span class="mf">0.3</span><span class="p">),</span>
        <span class="n">Bidirectional</span><span class="p">(</span><span class="n">LSTM</span><span class="p">(</span><span class="mi">64</span><span class="p">)),</span>
        <span class="n">BatchNormalization</span><span class="p">(),</span>
        <span class="n">Dropout</span><span class="p">(</span><span class="mf">0.3</span><span class="p">),</span>
        <span class="n">Dense</span><span class="p">(</span><span class="mi">128</span><span class="p">),</span>
        <span class="n">LeakyReLU</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.1</span><span class="p">),</span>
        <span class="n">Dropout</span><span class="p">(</span><span class="mf">0.2</span><span class="p">),</span>
        <span class="n">Dense</span><span class="p">(</span><span class="n">num_classes</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s1">&#39;softmax&#39;</span><span class="p">)</span>
    <span class="p">])</span>

    <span class="n">optimizer</span> <span class="o">=</span> <span class="n">Adam</span><span class="p">(</span><span class="n">learning_rate</span><span class="o">=</span><span class="mf">2e-4</span><span class="p">,</span> <span class="n">clipnorm</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span>
    <span class="n">model</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span>
        <span class="n">optimizer</span><span class="o">=</span><span class="n">optimizer</span><span class="p">,</span>
        <span class="n">loss</span><span class="o">=</span><span class="s1">&#39;sparse_categorical_crossentropy&#39;</span><span class="p">,</span>
        <span class="n">metrics</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;accuracy&#39;</span><span class="p">]</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="n">model</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">tensorflow.keras.callbacks</span><span class="w"> </span><span class="kn">import</span> <span class="n">EarlyStopping</span><span class="p">,</span> <span class="n">ReduceLROnPlateau</span><span class="p">,</span> <span class="n">ModelCheckpoint</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">time</span>

<span class="n">callbacks</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">EarlyStopping</span><span class="p">(</span><span class="n">monitor</span><span class="o">=</span><span class="s1">&#39;val_accuracy&#39;</span><span class="p">,</span> <span class="n">patience</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;max&#39;</span><span class="p">,</span> <span class="n">restore_best_weights</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
    <span class="n">ReduceLROnPlateau</span><span class="p">(</span><span class="n">monitor</span><span class="o">=</span><span class="s1">&#39;val_loss&#39;</span><span class="p">,</span> <span class="n">patience</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">factor</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">min_lr</span><span class="o">=</span><span class="mf">1e-6</span><span class="p">),</span>
    <span class="n">ModelCheckpoint</span><span class="p">(</span><span class="s2">&quot;best_bilstm_fasttext.h5&quot;</span><span class="p">,</span> <span class="n">monitor</span><span class="o">=</span><span class="s1">&#39;val_accuracy&#39;</span><span class="p">,</span> <span class="n">save_best_only</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;max&#39;</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="p">]</span>

<span class="n">t0</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
<span class="n">history</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span>
    <span class="n">X_train_pad</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span>
    <span class="n">validation_data</span><span class="o">=</span><span class="p">(</span><span class="n">X_val_pad</span><span class="p">,</span> <span class="n">y_val</span><span class="p">),</span>
    <span class="n">epochs</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span>
    <span class="n">batch_size</span><span class="o">=</span><span class="mi">128</span><span class="p">,</span>
    <span class="n">callbacks</span><span class="o">=</span><span class="n">callbacks</span><span class="p">,</span>
    <span class="n">verbose</span><span class="o">=</span><span class="mi">1</span>
<span class="p">)</span>
<span class="n">t1</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
<span class="n">train_time_s</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">t1</span> <span class="o">-</span> <span class="n">t0</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;â±ï¸ Tiempo total de entrenamiento: </span><span class="si">{</span><span class="n">train_time_s</span><span class="si">}</span><span class="s2"> segundos&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Epoch 1/50
<span class=" -Color -Color-Bold">15/15</span> <span class=" -Color -Color-Green">â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”</span> <span class=" -Color -Color-Bold">0s</span> 814ms/step - accuracy: 0.4992 - loss: 1.7426
Epoch 1: val_accuracy improved from None to 0.32353, saving model to best_bilstm_fasttext.h5
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>WARNING:absl:You are saving your model as an HDF5 file via `model.save()` or `keras.saving.save_model(model)`. This file format is considered legacy. We recommend using instead the native Keras format, e.g. `model.save(&#39;my_model.keras&#39;)` or `keras.saving.save_model(model, &#39;my_model.keras&#39;)`. 
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span><span class=" -Color -Color-Bold">15/15</span> <span class=" -Color -Color-Green">â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”</span> <span class=" -Color -Color-Bold">13s</span> 891ms/step - accuracy: 0.5100 - loss: 1.7265 - val_accuracy: 0.3235 - val_loss: 2.3828 - learning_rate: 1.0000e-04
Epoch 2/50
<span class=" -Color -Color-Bold">15/15</span> <span class=" -Color -Color-Green">â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”</span> <span class=" -Color -Color-Bold">0s</span> 799ms/step - accuracy: 0.5188 - loss: 1.7088
Epoch 2: val_accuracy did not improve from 0.32353
<span class=" -Color -Color-Bold">15/15</span> <span class=" -Color -Color-Green">â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”</span> <span class=" -Color -Color-Bold">13s</span> 863ms/step - accuracy: 0.5205 - loss: 1.7050 - val_accuracy: 0.3186 - val_loss: 2.3793 - learning_rate: 1.0000e-04
Epoch 3/50
<span class=" -Color -Color-Bold">15/15</span> <span class=" -Color -Color-Green">â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”</span> <span class=" -Color -Color-Bold">0s</span> 808ms/step - accuracy: 0.5126 - loss: 1.6800
Epoch 3: val_accuracy did not improve from 0.32353
<span class=" -Color -Color-Bold">15/15</span> <span class=" -Color -Color-Green">â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”</span> <span class=" -Color -Color-Bold">13s</span> 873ms/step - accuracy: 0.5247 - loss: 1.6644 - val_accuracy: 0.3211 - val_loss: 2.3749 - learning_rate: 1.0000e-04
Epoch 4/50
<span class=" -Color -Color-Bold">15/15</span> <span class=" -Color -Color-Green">â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”</span> <span class=" -Color -Color-Bold">0s</span> 797ms/step - accuracy: 0.5421 - loss: 1.6511
Epoch 4: val_accuracy improved from 0.32353 to 0.32598, saving model to best_bilstm_fasttext.h5
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>WARNING:absl:You are saving your model as an HDF5 file via `model.save()` or `keras.saving.save_model(model)`. This file format is considered legacy. We recommend using instead the native Keras format, e.g. `model.save(&#39;my_model.keras&#39;)` or `keras.saving.save_model(model, &#39;my_model.keras&#39;)`. 
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span><span class=" -Color -Color-Bold">15/15</span> <span class=" -Color -Color-Green">â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”</span> <span class=" -Color -Color-Bold">13s</span> 867ms/step - accuracy: 0.5431 - loss: 1.6369 - val_accuracy: 0.3260 - val_loss: 2.3723 - learning_rate: 1.0000e-04
Epoch 5/50
<span class=" -Color -Color-Bold">15/15</span> <span class=" -Color -Color-Green">â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”</span> <span class=" -Color -Color-Bold">0s</span> 748ms/step - accuracy: 0.5413 - loss: 1.6229
Epoch 5: val_accuracy improved from 0.32598 to 0.33824, saving model to best_bilstm_fasttext.h5
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>WARNING:absl:You are saving your model as an HDF5 file via `model.save()` or `keras.saving.save_model(model)`. This file format is considered legacy. We recommend using instead the native Keras format, e.g. `model.save(&#39;my_model.keras&#39;)` or `keras.saving.save_model(model, &#39;my_model.keras&#39;)`. 
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span><span class=" -Color -Color-Bold">15/15</span> <span class=" -Color -Color-Green">â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”</span> <span class=" -Color -Color-Bold">12s</span> 818ms/step - accuracy: 0.5410 - loss: 1.6159 - val_accuracy: 0.3382 - val_loss: 2.3676 - learning_rate: 1.0000e-04
Epoch 6/50
<span class=" -Color -Color-Bold">15/15</span> <span class=" -Color -Color-Green">â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”</span> <span class=" -Color -Color-Bold">0s</span> 753ms/step - accuracy: 0.5277 - loss: 1.6188
Epoch 6: val_accuracy did not improve from 0.33824
<span class=" -Color -Color-Bold">15/15</span> <span class=" -Color -Color-Green">â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”</span> <span class=" -Color -Color-Bold">12s</span> 816ms/step - accuracy: 0.5310 - loss: 1.6050 - val_accuracy: 0.3358 - val_loss: 2.3624 - learning_rate: 1.0000e-04
Epoch 7/50
<span class=" -Color -Color-Bold">15/15</span> <span class=" -Color -Color-Green">â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”</span> <span class=" -Color -Color-Bold">0s</span> 762ms/step - accuracy: 0.5443 - loss: 1.6296
Epoch 7: val_accuracy improved from 0.33824 to 0.34314, saving model to best_bilstm_fasttext.h5
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>WARNING:absl:You are saving your model as an HDF5 file via `model.save()` or `keras.saving.save_model(model)`. This file format is considered legacy. We recommend using instead the native Keras format, e.g. `model.save(&#39;my_model.keras&#39;)` or `keras.saving.save_model(model, &#39;my_model.keras&#39;)`. 
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span><span class=" -Color -Color-Bold">15/15</span> <span class=" -Color -Color-Green">â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”</span> <span class=" -Color -Color-Bold">13s</span> 829ms/step - accuracy: 0.5515 - loss: 1.5947 - val_accuracy: 0.3431 - val_loss: 2.3548 - learning_rate: 1.0000e-04
Epoch 8/50
<span class=" -Color -Color-Bold">15/15</span> <span class=" -Color -Color-Green">â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”</span> <span class=" -Color -Color-Bold">0s</span> 774ms/step - accuracy: 0.5413 - loss: 1.6265
Epoch 8: val_accuracy improved from 0.34314 to 0.34559, saving model to best_bilstm_fasttext.h5
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>WARNING:absl:You are saving your model as an HDF5 file via `model.save()` or `keras.saving.save_model(model)`. This file format is considered legacy. We recommend using instead the native Keras format, e.g. `model.save(&#39;my_model.keras&#39;)` or `keras.saving.save_model(model, &#39;my_model.keras&#39;)`. 
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span><span class=" -Color -Color-Bold">15/15</span> <span class=" -Color -Color-Green">â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”</span> <span class=" -Color -Color-Bold">13s</span> 848ms/step - accuracy: 0.5446 - loss: 1.5930 - val_accuracy: 0.3456 - val_loss: 2.3500 - learning_rate: 1.0000e-04
Epoch 9/50
<span class=" -Color -Color-Bold">15/15</span> <span class=" -Color -Color-Green">â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”</span> <span class=" -Color -Color-Bold">0s</span> 773ms/step - accuracy: 0.5479 - loss: 1.5832
Epoch 9: val_accuracy did not improve from 0.34559
<span class=" -Color -Color-Bold">15/15</span> <span class=" -Color -Color-Green">â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”</span> <span class=" -Color -Color-Bold">12s</span> 833ms/step - accuracy: 0.5604 - loss: 1.5621 - val_accuracy: 0.3407 - val_loss: 2.3478 - learning_rate: 1.0000e-04
Epoch 10/50
<span class=" -Color -Color-Bold">15/15</span> <span class=" -Color -Color-Green">â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”</span> <span class=" -Color -Color-Bold">0s</span> 833ms/step - accuracy: 0.5826 - loss: 1.5351
Epoch 10: val_accuracy did not improve from 0.34559
<span class=" -Color -Color-Bold">15/15</span> <span class=" -Color -Color-Green">â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”</span> <span class=" -Color -Color-Bold">13s</span> 894ms/step - accuracy: 0.5772 - loss: 1.5233 - val_accuracy: 0.3456 - val_loss: 2.3455 - learning_rate: 1.0000e-04
Epoch 11/50
<span class=" -Color -Color-Bold">15/15</span> <span class=" -Color -Color-Green">â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”</span> <span class=" -Color -Color-Bold">0s</span> 785ms/step - accuracy: 0.5930 - loss: 1.5175
Epoch 11: val_accuracy improved from 0.34559 to 0.34804, saving model to best_bilstm_fasttext.h5
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>WARNING:absl:You are saving your model as an HDF5 file via `model.save()` or `keras.saving.save_model(model)`. This file format is considered legacy. We recommend using instead the native Keras format, e.g. `model.save(&#39;my_model.keras&#39;)` or `keras.saving.save_model(model, &#39;my_model.keras&#39;)`. 
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span><span class=" -Color -Color-Bold">15/15</span> <span class=" -Color -Color-Green">â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”</span> <span class=" -Color -Color-Bold">13s</span> 858ms/step - accuracy: 0.5840 - loss: 1.5143 - val_accuracy: 0.3480 - val_loss: 2.3395 - learning_rate: 1.0000e-04
Epoch 12/50
<span class=" -Color -Color-Bold">15/15</span> <span class=" -Color -Color-Green">â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”</span> <span class=" -Color -Color-Bold">0s</span> 761ms/step - accuracy: 0.5706 - loss: 1.5085
Epoch 12: val_accuracy did not improve from 0.34804
<span class=" -Color -Color-Bold">15/15</span> <span class=" -Color -Color-Green">â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”</span> <span class=" -Color -Color-Bold">12s</span> 820ms/step - accuracy: 0.5856 - loss: 1.4921 - val_accuracy: 0.3480 - val_loss: 2.3392 - learning_rate: 1.0000e-04
Epoch 13/50
<span class=" -Color -Color-Bold">15/15</span> <span class=" -Color -Color-Green">â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”</span> <span class=" -Color -Color-Bold">0s</span> 837ms/step - accuracy: 0.5816 - loss: 1.4845
Epoch 13: val_accuracy did not improve from 0.34804
<span class=" -Color -Color-Bold">15/15</span> <span class=" -Color -Color-Green">â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”</span> <span class=" -Color -Color-Bold">13s</span> 898ms/step - accuracy: 0.5935 - loss: 1.4578 - val_accuracy: 0.3456 - val_loss: 2.3385 - learning_rate: 1.0000e-04
Epoch 14/50
<span class=" -Color -Color-Bold">15/15</span> <span class=" -Color -Color-Green">â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”</span> <span class=" -Color -Color-Bold">0s</span> 775ms/step - accuracy: 0.5743 - loss: 1.4907
Epoch 14: val_accuracy did not improve from 0.34804
<span class=" -Color -Color-Bold">15/15</span> <span class=" -Color -Color-Green">â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”</span> <span class=" -Color -Color-Bold">12s</span> 836ms/step - accuracy: 0.5804 - loss: 1.4713 - val_accuracy: 0.3431 - val_loss: 2.3330 - learning_rate: 1.0000e-04
Epoch 15/50
<span class=" -Color -Color-Bold">15/15</span> <span class=" -Color -Color-Green">â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”</span> <span class=" -Color -Color-Bold">0s</span> 770ms/step - accuracy: 0.5576 - loss: 1.5020
Epoch 15: val_accuracy did not improve from 0.34804
<span class=" -Color -Color-Bold">15/15</span> <span class=" -Color -Color-Green">â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”</span> <span class=" -Color -Color-Bold">13s</span> 874ms/step - accuracy: 0.5788 - loss: 1.4702 - val_accuracy: 0.3456 - val_loss: 2.3281 - learning_rate: 1.0000e-04
Epoch 16/50
<span class=" -Color -Color-Bold">15/15</span> <span class=" -Color -Color-Green">â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”</span> <span class=" -Color -Color-Bold">0s</span> 779ms/step - accuracy: 0.6137 - loss: 1.4284
Epoch 16: val_accuracy improved from 0.34804 to 0.35049, saving model to best_bilstm_fasttext.h5
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>WARNING:absl:You are saving your model as an HDF5 file via `model.save()` or `keras.saving.save_model(model)`. This file format is considered legacy. We recommend using instead the native Keras format, e.g. `model.save(&#39;my_model.keras&#39;)` or `keras.saving.save_model(model, &#39;my_model.keras&#39;)`. 
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span><span class=" -Color -Color-Bold">15/15</span> <span class=" -Color -Color-Green">â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”</span> <span class=" -Color -Color-Bold">13s</span> 846ms/step - accuracy: 0.5998 - loss: 1.4326 - val_accuracy: 0.3505 - val_loss: 2.3241 - learning_rate: 1.0000e-04
Epoch 17/50
<span class=" -Color -Color-Bold">15/15</span> <span class=" -Color -Color-Green">â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”</span> <span class=" -Color -Color-Bold">0s</span> 752ms/step - accuracy: 0.6018 - loss: 1.4057
Epoch 17: val_accuracy did not improve from 0.35049
<span class=" -Color -Color-Bold">15/15</span> <span class=" -Color -Color-Green">â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”</span> <span class=" -Color -Color-Bold">12s</span> 815ms/step - accuracy: 0.6071 - loss: 1.3951 - val_accuracy: 0.3505 - val_loss: 2.3224 - learning_rate: 1.0000e-04
Epoch 18/50
<span class=" -Color -Color-Bold">15/15</span> <span class=" -Color -Color-Green">â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”</span> <span class=" -Color -Color-Bold">0s</span> 806ms/step - accuracy: 0.6005 - loss: 1.4082
Epoch 18: val_accuracy improved from 0.35049 to 0.35294, saving model to best_bilstm_fasttext.h5
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>WARNING:absl:You are saving your model as an HDF5 file via `model.save()` or `keras.saving.save_model(model)`. This file format is considered legacy. We recommend using instead the native Keras format, e.g. `model.save(&#39;my_model.keras&#39;)` or `keras.saving.save_model(model, &#39;my_model.keras&#39;)`. 
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span><span class=" -Color -Color-Bold">15/15</span> <span class=" -Color -Color-Green">â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”</span> <span class=" -Color -Color-Bold">13s</span> 878ms/step - accuracy: 0.6134 - loss: 1.3996 - val_accuracy: 0.3529 - val_loss: 2.3230 - learning_rate: 1.0000e-04
Epoch 19/50
<span class=" -Color -Color-Bold">15/15</span> <span class=" -Color -Color-Green">â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”</span> <span class=" -Color -Color-Bold">0s</span> 753ms/step - accuracy: 0.6127 - loss: 1.3746
Epoch 19: val_accuracy did not improve from 0.35294
<span class=" -Color -Color-Bold">15/15</span> <span class=" -Color -Color-Green">â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”</span> <span class=" -Color -Color-Bold">12s</span> 817ms/step - accuracy: 0.6234 - loss: 1.3636 - val_accuracy: 0.3529 - val_loss: 2.3288 - learning_rate: 1.0000e-04
Epoch 20/50
<span class=" -Color -Color-Bold">15/15</span> <span class=" -Color -Color-Green">â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”</span> <span class=" -Color -Color-Bold">0s</span> 758ms/step - accuracy: 0.6097 - loss: 1.3595
Epoch 20: val_accuracy improved from 0.35294 to 0.36029, saving model to best_bilstm_fasttext.h5
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>WARNING:absl:You are saving your model as an HDF5 file via `model.save()` or `keras.saving.save_model(model)`. This file format is considered legacy. We recommend using instead the native Keras format, e.g. `model.save(&#39;my_model.keras&#39;)` or `keras.saving.save_model(model, &#39;my_model.keras&#39;)`. 
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span><span class=" -Color -Color-Bold">15/15</span> <span class=" -Color -Color-Green">â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”</span> <span class=" -Color -Color-Bold">12s</span> 827ms/step - accuracy: 0.6218 - loss: 1.3544 - val_accuracy: 0.3603 - val_loss: 2.3254 - learning_rate: 1.0000e-04
Epoch 21/50
<span class=" -Color -Color-Bold">15/15</span> <span class=" -Color -Color-Green">â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”</span> <span class=" -Color -Color-Bold">0s</span> 733ms/step - accuracy: 0.6266 - loss: 1.3608
Epoch 21: val_accuracy did not improve from 0.36029
<span class=" -Color -Color-Bold">15/15</span> <span class=" -Color -Color-Green">â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”</span> <span class=" -Color -Color-Bold">12s</span> 792ms/step - accuracy: 0.6297 - loss: 1.3499 - val_accuracy: 0.3554 - val_loss: 2.3241 - learning_rate: 5.0000e-05
Epoch 22/50
<span class=" -Color -Color-Bold">15/15</span> <span class=" -Color -Color-Green">â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”</span> <span class=" -Color -Color-Bold">0s</span> 775ms/step - accuracy: 0.6231 - loss: 1.3493
Epoch 22: val_accuracy did not improve from 0.36029
<span class=" -Color -Color-Bold">15/15</span> <span class=" -Color -Color-Green">â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”</span> <span class=" -Color -Color-Bold">12s</span> 831ms/step - accuracy: 0.6308 - loss: 1.3249 - val_accuracy: 0.3578 - val_loss: 2.3213 - learning_rate: 5.0000e-05
Epoch 23/50
<span class=" -Color -Color-Bold">15/15</span> <span class=" -Color -Color-Green">â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”</span> <span class=" -Color -Color-Bold">0s</span> 731ms/step - accuracy: 0.6180 - loss: 1.3307
Epoch 23: val_accuracy did not improve from 0.36029
<span class=" -Color -Color-Bold">15/15</span> <span class=" -Color -Color-Green">â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”</span> <span class=" -Color -Color-Bold">12s</span> 789ms/step - accuracy: 0.6313 - loss: 1.3176 - val_accuracy: 0.3603 - val_loss: 2.3188 - learning_rate: 5.0000e-05
Epoch 24/50
<span class=" -Color -Color-Bold">15/15</span> <span class=" -Color -Color-Green">â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”</span> <span class=" -Color -Color-Bold">0s</span> 716ms/step - accuracy: 0.6362 - loss: 1.3279
Epoch 24: val_accuracy did not improve from 0.36029
<span class=" -Color -Color-Bold">15/15</span> <span class=" -Color -Color-Green">â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”</span> <span class=" -Color -Color-Bold">12s</span> 776ms/step - accuracy: 0.6234 - loss: 1.3334 - val_accuracy: 0.3603 - val_loss: 2.3180 - learning_rate: 5.0000e-05
Epoch 25/50
<span class=" -Color -Color-Bold">15/15</span> <span class=" -Color -Color-Green">â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”</span> <span class=" -Color -Color-Bold">0s</span> 743ms/step - accuracy: 0.6327 - loss: 1.3414
Epoch 25: val_accuracy improved from 0.36029 to 0.36275, saving model to best_bilstm_fasttext.h5
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>WARNING:absl:You are saving your model as an HDF5 file via `model.save()` or `keras.saving.save_model(model)`. This file format is considered legacy. We recommend using instead the native Keras format, e.g. `model.save(&#39;my_model.keras&#39;)` or `keras.saving.save_model(model, &#39;my_model.keras&#39;)`. 
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span><span class=" -Color -Color-Bold">15/15</span> <span class=" -Color -Color-Green">â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”</span> <span class=" -Color -Color-Bold">12s</span> 809ms/step - accuracy: 0.6392 - loss: 1.3110 - val_accuracy: 0.3627 - val_loss: 2.3158 - learning_rate: 5.0000e-05
Epoch 26/50
<span class=" -Color -Color-Bold">15/15</span> <span class=" -Color -Color-Green">â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”</span> <span class=" -Color -Color-Bold">0s</span> 713ms/step - accuracy: 0.6295 - loss: 1.3445
Epoch 26: val_accuracy did not improve from 0.36275
<span class=" -Color -Color-Bold">15/15</span> <span class=" -Color -Color-Green">â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”</span> <span class=" -Color -Color-Bold">12s</span> 768ms/step - accuracy: 0.6381 - loss: 1.3081 - val_accuracy: 0.3627 - val_loss: 2.3138 - learning_rate: 5.0000e-05
Epoch 27/50
<span class=" -Color -Color-Bold">15/15</span> <span class=" -Color -Color-Green">â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”</span> <span class=" -Color -Color-Bold">0s</span> 709ms/step - accuracy: 0.6499 - loss: 1.2938
Epoch 27: val_accuracy did not improve from 0.36275
<span class=" -Color -Color-Bold">15/15</span> <span class=" -Color -Color-Green">â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”</span> <span class=" -Color -Color-Bold">11s</span> 765ms/step - accuracy: 0.6497 - loss: 1.2795 - val_accuracy: 0.3554 - val_loss: 2.3128 - learning_rate: 5.0000e-05
Epoch 28/50
<span class=" -Color -Color-Bold">15/15</span> <span class=" -Color -Color-Green">â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”</span> <span class=" -Color -Color-Bold">0s</span> 746ms/step - accuracy: 0.6414 - loss: 1.3016
Epoch 28: val_accuracy did not improve from 0.36275
<span class=" -Color -Color-Bold">15/15</span> <span class=" -Color -Color-Green">â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”</span> <span class=" -Color -Color-Bold">12s</span> 810ms/step - accuracy: 0.6413 - loss: 1.2795 - val_accuracy: 0.3578 - val_loss: 2.3135 - learning_rate: 5.0000e-05
Epoch 29/50
<span class=" -Color -Color-Bold">15/15</span> <span class=" -Color -Color-Green">â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”</span> <span class=" -Color -Color-Bold">0s</span> 834ms/step - accuracy: 0.6562 - loss: 1.2497
Epoch 29: val_accuracy did not improve from 0.36275
<span class=" -Color -Color-Bold">15/15</span> <span class=" -Color -Color-Green">â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”</span> <span class=" -Color -Color-Bold">13s</span> 896ms/step - accuracy: 0.6534 - loss: 1.2539 - val_accuracy: 0.3578 - val_loss: 2.3136 - learning_rate: 5.0000e-05
Epoch 30/50
<span class=" -Color -Color-Bold">15/15</span> <span class=" -Color -Color-Green">â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”</span> <span class=" -Color -Color-Bold">0s</span> 761ms/step - accuracy: 0.6409 - loss: 1.3043
Epoch 30: val_accuracy did not improve from 0.36275
<span class=" -Color -Color-Bold">15/15</span> <span class=" -Color -Color-Green">â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”</span> <span class=" -Color -Color-Bold">12s</span> 824ms/step - accuracy: 0.6486 - loss: 1.2681 - val_accuracy: 0.3554 - val_loss: 2.3111 - learning_rate: 5.0000e-05
â±ï¸ Tiempo total de entrenamiento: 374.85 segundos
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">sklearn.metrics</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
    <span class="n">accuracy_score</span><span class="p">,</span> <span class="n">precision_score</span><span class="p">,</span> <span class="n">recall_score</span><span class="p">,</span> <span class="n">f1_score</span><span class="p">,</span> <span class="n">roc_auc_score</span>
<span class="p">)</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">time</span>

<span class="c1"># ðŸ”¹ EvaluaciÃ³n</span>
<span class="n">t_eval_0</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
<span class="n">y_pred_proba</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test_pad</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">y_pred</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">y_pred_proba</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">t_eval_1</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>

<span class="c1"># ðŸ”¹ MÃ©tricas clÃ¡sicas</span>
<span class="n">accuracy</span>  <span class="o">=</span> <span class="n">accuracy_score</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)</span>
<span class="n">precision</span> <span class="o">=</span> <span class="n">precision_score</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">,</span> <span class="n">average</span><span class="o">=</span><span class="s1">&#39;macro&#39;</span><span class="p">,</span> <span class="n">zero_division</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">recall</span>    <span class="o">=</span> <span class="n">recall_score</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">,</span> <span class="n">average</span><span class="o">=</span><span class="s1">&#39;macro&#39;</span><span class="p">,</span> <span class="n">zero_division</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">f1</span>        <span class="o">=</span> <span class="n">f1_score</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">,</span> <span class="n">average</span><span class="o">=</span><span class="s1">&#39;macro&#39;</span><span class="p">,</span> <span class="n">zero_division</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

<span class="c1"># ðŸ”¹ ROC-AUC One-vs-Rest</span>
<span class="k">try</span><span class="p">:</span>
    <span class="c1"># Para multiclase se necesita probas (no etiquetas)</span>
    <span class="n">roc_auc</span> <span class="o">=</span> <span class="n">roc_auc_score</span><span class="p">(</span>
        <span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred_proba</span><span class="p">,</span> <span class="n">multi_class</span><span class="o">=</span><span class="s1">&#39;ovr&#39;</span><span class="p">,</span> <span class="n">average</span><span class="o">=</span><span class="s1">&#39;macro&#39;</span>
    <span class="p">)</span>
<span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
    <span class="n">roc_auc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;âš ï¸ No se pudo calcular ROC-AUC: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># ðŸ”¹ Mostrar resumen</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">ðŸ“ˆ Resultados finales:&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;   Accuracy:          </span><span class="si">{</span><span class="n">accuracy</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;   Precision (Macro): </span><span class="si">{</span><span class="n">precision</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;   Recall (Macro):    </span><span class="si">{</span><span class="n">recall</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;   F1-Score (Macro):  </span><span class="si">{</span><span class="n">f1</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;   ROC-AUC (OvR):     </span><span class="si">{</span><span class="n">roc_auc</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;   Tiempo entrenamiento: </span><span class="si">{</span><span class="n">train_time_s</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> s&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;   Tiempo evaluaciÃ³n:   </span><span class="si">{</span><span class="n">t_eval_1</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">t_eval_0</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> s&quot;</span><span class="p">)</span>

<span class="c1"># ðŸ”¹ Guardar en DataFrame</span>
<span class="n">df_metrics</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">([{</span>
    <span class="s2">&quot;Accuracy&quot;</span><span class="p">:</span> <span class="n">accuracy</span><span class="p">,</span>
    <span class="s2">&quot;Precision (Macro)&quot;</span><span class="p">:</span> <span class="n">precision</span><span class="p">,</span>
    <span class="s2">&quot;Recall (Macro)&quot;</span><span class="p">:</span> <span class="n">recall</span><span class="p">,</span>
    <span class="s2">&quot;F1-Score (Macro)&quot;</span><span class="p">:</span> <span class="n">f1</span><span class="p">,</span>
    <span class="s2">&quot;Train Time (s)&quot;</span><span class="p">:</span> <span class="n">train_time_s</span><span class="p">,</span>
    <span class="s2">&quot;ROC-AUC (OvR)&quot;</span><span class="p">:</span> <span class="n">roc_auc</span>
<span class="p">}])</span>

<span class="n">display</span><span class="p">(</span><span class="n">df_metrics</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span><span class=" -Color -Color-Bold">13/13</span> <span class=" -Color -Color-Green">â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”</span> <span class=" -Color -Color-Bold">3s</span> 218ms/step

ðŸ“ˆ Resultados finales:
   Accuracy:          0.3652
   Precision (Macro): 0.3451
   Recall (Macro):    0.3612
   F1-Score (Macro):  0.3469
   ROC-AUC (OvR):     0.8190
   Tiempo entrenamiento: 374.85 s
   Tiempo evaluaciÃ³n:   2.94 s
</pre></div>
</div>
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Accuracy</th>
      <th>Precision (Macro)</th>
      <th>Recall (Macro)</th>
      <th>F1-Score (Macro)</th>
      <th>Train Time (s)</th>
      <th>ROC-AUC (OvR)</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0.365196</td>
      <td>0.345104</td>
      <td>0.361165</td>
      <td>0.346888</td>
      <td>374.85</td>
      <td>0.818993</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># ðŸ”¹ Guardar CSV en el proyecto</span>
<span class="n">df_metrics</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s2">&quot;resultados_bilstm_fasttext.csv&quot;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">ðŸ’¾ Resultados guardados en &#39;resultados_bilstm_fasttext.csv&#39;&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>ðŸ’¾ Resultados guardados en &#39;resultados_bilstm_fasttext.csv&#39;
</pre></div>
</div>
</div>
</div>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="cnn-1d-con-embeddings">
<h1>CNN-1D con Embeddings<a class="headerlink" href="#cnn-1d-con-embeddings" title="Permalink to this heading">#</a></h1>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">tensorflow.keras.models</span><span class="w"> </span><span class="kn">import</span> <span class="n">Sequential</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">tensorflow.keras.layers</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
    <span class="n">Embedding</span><span class="p">,</span> <span class="n">Conv1D</span><span class="p">,</span> <span class="n">GlobalMaxPooling1D</span><span class="p">,</span>
    <span class="n">Dropout</span><span class="p">,</span> <span class="n">Dense</span><span class="p">,</span> <span class="n">BatchNormalization</span>
<span class="p">)</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">tensorflow.keras.optimizers</span><span class="w"> </span><span class="kn">import</span> <span class="n">Adam</span>

<span class="k">def</span><span class="w"> </span><span class="nf">build_cnn1d</span><span class="p">(</span><span class="n">vocab_size</span><span class="p">,</span> <span class="n">emb_dim</span><span class="p">,</span> <span class="n">embedding_matrix</span><span class="p">,</span> <span class="n">sequence_length</span><span class="p">,</span> <span class="n">num_classes</span><span class="p">):</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">Sequential</span><span class="p">([</span>
        <span class="n">Embedding</span><span class="p">(</span>
            <span class="n">input_dim</span><span class="o">=</span><span class="n">vocab_size</span><span class="p">,</span>
            <span class="n">output_dim</span><span class="o">=</span><span class="n">emb_dim</span><span class="p">,</span>
            <span class="n">weights</span><span class="o">=</span><span class="p">[</span><span class="n">embedding_matrix</span><span class="p">],</span>
            <span class="n">input_length</span><span class="o">=</span><span class="n">sequence_length</span><span class="p">,</span>
            <span class="n">trainable</span><span class="o">=</span><span class="kc">False</span>  <span class="c1"># usamos FastText fijo</span>
        <span class="p">),</span>
        <span class="n">Conv1D</span><span class="p">(</span><span class="mi">256</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s1">&#39;relu&#39;</span><span class="p">,</span> <span class="n">padding</span><span class="o">=</span><span class="s1">&#39;same&#39;</span><span class="p">),</span>
        <span class="n">BatchNormalization</span><span class="p">(),</span>
        <span class="n">Dropout</span><span class="p">(</span><span class="mf">0.3</span><span class="p">),</span>

        <span class="n">Conv1D</span><span class="p">(</span><span class="mi">128</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s1">&#39;relu&#39;</span><span class="p">,</span> <span class="n">padding</span><span class="o">=</span><span class="s1">&#39;same&#39;</span><span class="p">),</span>
        <span class="n">BatchNormalization</span><span class="p">(),</span>
        <span class="n">GlobalMaxPooling1D</span><span class="p">(),</span>

        <span class="n">Dense</span><span class="p">(</span><span class="mi">128</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s1">&#39;relu&#39;</span><span class="p">),</span>
        <span class="n">Dropout</span><span class="p">(</span><span class="mf">0.3</span><span class="p">),</span>
        <span class="n">Dense</span><span class="p">(</span><span class="n">num_classes</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s1">&#39;softmax&#39;</span><span class="p">)</span>
    <span class="p">])</span>

    <span class="n">optimizer</span> <span class="o">=</span> <span class="n">Adam</span><span class="p">(</span><span class="n">learning_rate</span><span class="o">=</span><span class="mf">1e-4</span><span class="p">)</span>
    <span class="n">model</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span>
        <span class="n">optimizer</span><span class="o">=</span><span class="n">optimizer</span><span class="p">,</span>
        <span class="n">loss</span><span class="o">=</span><span class="s1">&#39;sparse_categorical_crossentropy&#39;</span><span class="p">,</span>
        <span class="n">metrics</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;accuracy&#39;</span><span class="p">]</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="n">model</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">tensorflow.keras.callbacks</span><span class="w"> </span><span class="kn">import</span> <span class="n">EarlyStopping</span><span class="p">,</span> <span class="n">ReduceLROnPlateau</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">time</span>

<span class="n">cnn_model</span> <span class="o">=</span> <span class="n">build_cnn1d</span><span class="p">(</span><span class="n">vocab_size</span><span class="p">,</span> <span class="n">EMB_DIM</span><span class="p">,</span> <span class="n">embedding_matrix</span><span class="p">,</span> <span class="n">MAX_LEN</span><span class="p">,</span> <span class="n">num_classes</span><span class="p">)</span>

<span class="n">callbacks</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">EarlyStopping</span><span class="p">(</span><span class="n">patience</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">restore_best_weights</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">monitor</span><span class="o">=</span><span class="s1">&#39;val_loss&#39;</span><span class="p">),</span>
    <span class="n">ReduceLROnPlateau</span><span class="p">(</span><span class="n">patience</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">factor</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">monitor</span><span class="o">=</span><span class="s1">&#39;val_loss&#39;</span><span class="p">,</span> <span class="n">min_lr</span><span class="o">=</span><span class="mf">1e-5</span><span class="p">)</span>
<span class="p">]</span>

<span class="n">t0</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
<span class="n">history_cnn</span> <span class="o">=</span> <span class="n">cnn_model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span>
    <span class="n">X_train_pad</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span>
    <span class="n">validation_data</span><span class="o">=</span><span class="p">(</span><span class="n">X_val_pad</span><span class="p">,</span> <span class="n">y_val</span><span class="p">),</span>
    <span class="n">epochs</span><span class="o">=</span><span class="mi">40</span><span class="p">,</span>
    <span class="n">batch_size</span><span class="o">=</span><span class="mi">64</span><span class="p">,</span>
    <span class="n">callbacks</span><span class="o">=</span><span class="n">callbacks</span><span class="p">,</span>
    <span class="n">verbose</span><span class="o">=</span><span class="mi">1</span>
<span class="p">)</span>
<span class="n">t1</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
<span class="n">train_time_cnn</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">t1</span> <span class="o">-</span> <span class="n">t0</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;â±ï¸ Tiempo total de entrenamiento: </span><span class="si">{</span><span class="n">train_time_cnn</span><span class="si">}</span><span class="s2"> segundos&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Epoch 1/40
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/home/nicoplayz/tf312/lib/python3.12/site-packages/keras/src/layers/core/embedding.py:97: UserWarning: Argument `input_length` is deprecated. Just remove it.
  warnings.warn(
2025-11-06 15:04:32.998861: I external/local_xla/xla/service/service.cc:153] XLA service 0x7e32580086a0 initialized for platform CUDA (this does not guarantee that XLA will be used). Devices:
2025-11-06 15:04:32.999707: I external/local_xla/xla/service/service.cc:161]   StreamExecutor device (0): NVIDIA GeForce RTX 5070 Laptop GPU, Compute Capability 12.0
2025-11-06 15:04:33.110136: I tensorflow/compiler/mlir/tensorflow/utils/dump_mlir_util.cc:269] disabling MLIR crash reproducer, set env var `MLIR_CRASH_REPRODUCER_DIRECTORY` to enable.
2025-11-06 15:04:33.467191: W external/local_xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2025-11-06 15:04:33.467230: W external/local_xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2025-11-06 15:04:33.467454: W external/local_xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2025-11-06 15:04:33.467480: W external/local_xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2025-11-06 15:04:33.467487: W external/local_xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2025-11-06 15:04:33.467493: W external/local_xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2025-11-06 15:04:34.165096: I external/local_xla/xla/stream_executor/cuda/subprocess_compilation.cc:346] ptxas warning : Registers are spilled to local memory in function &#39;gemm_fusion_dot_1563&#39;, 184 bytes spill stores, 184 bytes spill loads

2025-11-06 15:04:34.249287: I external/local_xla/xla/stream_executor/cuda/subprocess_compilation.cc:346] ptxas warning : Registers are spilled to local memory in function &#39;gemm_fusion_dot_1563&#39;, 128 bytes spill stores, 128 bytes spill loads

2025-11-06 15:04:34.280957: I external/local_xla/xla/stream_executor/cuda/subprocess_compilation.cc:346] ptxas warning : Registers are spilled to local memory in function &#39;gemm_fusion_dot_1563&#39;, 112 bytes spill stores, 112 bytes spill loads

2025-11-06 15:04:34.493931: I external/local_xla/xla/stream_executor/cuda/subprocess_compilation.cc:346] ptxas warning : Registers are spilled to local memory in function &#39;gemm_fusion_dot_1582&#39;, 48 bytes spill stores, 48 bytes spill loads

2025-11-06 15:04:34.502686: I external/local_xla/xla/stream_executor/cuda/subprocess_compilation.cc:346] ptxas warning : Registers are spilled to local memory in function &#39;gemm_fusion_dot_1563&#39;, 136 bytes spill stores, 136 bytes spill loads

2025-11-06 15:04:34.524716: I external/local_xla/xla/stream_executor/cuda/subprocess_compilation.cc:346] ptxas warning : Registers are spilled to local memory in function &#39;gemm_fusion_dot_1582&#39;, 12 bytes spill stores, 12 bytes spill loads

2025-11-06 15:04:34.886550: I external/local_xla/xla/stream_executor/cuda/subprocess_compilation.cc:346] ptxas warning : Registers are spilled to local memory in function &#39;gemm_fusion_dot_1582&#39;, 104 bytes spill stores, 104 bytes spill loads

2025-11-06 15:04:35.078361: I external/local_xla/xla/stream_executor/cuda/subprocess_compilation.cc:346] ptxas warning : Registers are spilled to local memory in function &#39;gemm_fusion_dot_1762&#39;, 264 bytes spill stores, 264 bytes spill loads

2025-11-06 15:04:35.230901: I external/local_xla/xla/stream_executor/cuda/subprocess_compilation.cc:346] ptxas warning : Registers are spilled to local memory in function &#39;gemm_fusion_dot_1762&#39;, 260 bytes spill stores, 260 bytes spill loads

2025-11-06 15:04:35.349979: I external/local_xla/xla/stream_executor/cuda/subprocess_compilation.cc:346] ptxas warning : Registers are spilled to local memory in function &#39;gemm_fusion_dot_1778&#39;, 232 bytes spill stores, 232 bytes spill loads

2025-11-06 15:04:35.393328: I external/local_xla/xla/stream_executor/cuda/subprocess_compilation.cc:346] ptxas warning : Registers are spilled to local memory in function &#39;gemm_fusion_dot_1778&#39;, 236 bytes spill stores, 236 bytes spill loads

2025-11-06 15:04:36.295201: W external/local_xla/xla/tsl/framework/bfc_allocator.cc:310] Allocator (GPU_0_bfc) ran out of memory trying to allocate 11.93GiB with freed_by_count=0. The caller indicates that this is not a failure, but this may mean that there could be performance gains if more memory were available.
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span><span class=" -Color -Color-Bold">16/30</span> <span class=" -Color -Color-Green">â”â”â”â”â”â”â”â”â”â”</span><span class=" -Color -Color-White">â”â”â”â”â”â”â”â”â”â”</span> <span class=" -Color -Color-Bold">0s</span> 4ms/step - accuracy: 0.0350 - loss: 7.5023 
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>I0000 00:00:1762459478.315882  214569 device_compiler.h:196] Compiled cluster using XLA!  This line is logged at most once for the lifetime of the process.
2025-11-06 15:04:38.582137: W external/local_xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2025-11-06 15:04:38.582176: W external/local_xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2025-11-06 15:04:38.582184: W external/local_xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2025-11-06 15:04:38.582189: W external/local_xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2025-11-06 15:04:38.582195: W external/local_xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2025-11-06 15:04:38.582199: W external/local_xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2025-11-06 15:04:39.053745: I external/local_xla/xla/stream_executor/cuda/subprocess_compilation.cc:346] ptxas warning : Registers are spilled to local memory in function &#39;gemm_fusion_dot_1563&#39;, 160 bytes spill stores, 160 bytes spill loads

2025-11-06 15:04:39.288200: I external/local_xla/xla/stream_executor/cuda/subprocess_compilation.cc:346] ptxas warning : Registers are spilled to local memory in function &#39;gemm_fusion_dot_1373&#39;, 24 bytes spill stores, 24 bytes spill loads

2025-11-06 15:04:39.391714: I external/local_xla/xla/stream_executor/cuda/subprocess_compilation.cc:346] ptxas warning : Registers are spilled to local memory in function &#39;gemm_fusion_dot_1373&#39;, 8 bytes spill stores, 8 bytes spill loads

2025-11-06 15:04:39.742732: I external/local_xla/xla/stream_executor/cuda/subprocess_compilation.cc:346] ptxas warning : Registers are spilled to local memory in function &#39;gemm_fusion_dot_1582&#39;, 56 bytes spill stores, 56 bytes spill loads

2025-11-06 15:04:40.010435: I external/local_xla/xla/stream_executor/cuda/subprocess_compilation.cc:346] ptxas warning : Registers are spilled to local memory in function &#39;gemm_fusion_dot_1582&#39;, 20 bytes spill stores, 20 bytes spill loads

2025-11-06 15:04:40.076218: I external/local_xla/xla/stream_executor/cuda/subprocess_compilation.cc:346] ptxas warning : Registers are spilled to local memory in function &#39;gemm_fusion_dot_1582&#39;, 128 bytes spill stores, 128 bytes spill loads

2025-11-06 15:04:40.369497: W external/local_xla/xla/tsl/framework/bfc_allocator.cc:310] Allocator (GPU_0_bfc) ran out of memory trying to allocate 11.33GiB with freed_by_count=0. The caller indicates that this is not a failure, but this may mean that there could be performance gains if more memory were available.
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span><span class=" -Color -Color-Bold">30/30</span> <span class=" -Color -Color-Green">â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”</span> <span class=" -Color -Color-Bold">0s</span> 130ms/step - accuracy: 0.0365 - loss: 7.0951
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-11-06 15:04:42.274413: W external/local_xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2025-11-06 15:04:42.764589: I external/local_xla/xla/stream_executor/cuda/subprocess_compilation.cc:346] ptxas warning : Registers are spilled to local memory in function &#39;gemm_fusion_dot_114&#39;, 84 bytes spill stores, 84 bytes spill loads

2025-11-06 15:04:42.775313: I external/local_xla/xla/stream_executor/cuda/subprocess_compilation.cc:346] ptxas warning : Registers are spilled to local memory in function &#39;gemm_fusion_dot_114&#39;, 120 bytes spill stores, 120 bytes spill loads

2025-11-06 15:04:42.847357: I external/local_xla/xla/stream_executor/cuda/subprocess_compilation.cc:346] ptxas warning : Registers are spilled to local memory in function &#39;gemm_fusion_dot_114&#39;, 92 bytes spill stores, 92 bytes spill loads

2025-11-06 15:04:43.989491: W external/local_xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2025-11-06 15:04:43.989533: W external/local_xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2025-11-06 15:04:44.602250: I external/local_xla/xla/stream_executor/cuda/subprocess_compilation.cc:346] ptxas warning : Registers are spilled to local memory in function &#39;gemm_fusion_dot_114&#39;, 80 bytes spill stores, 80 bytes spill loads

2025-11-06 15:04:44.639199: I external/local_xla/xla/stream_executor/cuda/subprocess_compilation.cc:346] ptxas warning : Registers are spilled to local memory in function &#39;gemm_fusion_dot_107&#39;, 24 bytes spill stores, 24 bytes spill loads

2025-11-06 15:04:44.716303: I external/local_xla/xla/stream_executor/cuda/subprocess_compilation.cc:346] ptxas warning : Registers are spilled to local memory in function &#39;gemm_fusion_dot_107&#39;, 24 bytes spill stores, 24 bytes spill loads

2025-11-06 15:04:44.754462: I external/local_xla/xla/stream_executor/cuda/subprocess_compilation.cc:346] ptxas warning : Registers are spilled to local memory in function &#39;gemm_fusion_dot_114&#39;, 92 bytes spill stores, 92 bytes spill loads

2025-11-06 15:04:44.758974: I external/local_xla/xla/stream_executor/cuda/subprocess_compilation.cc:346] ptxas warning : Registers are spilled to local memory in function &#39;gemm_fusion_dot_114&#39;, 92 bytes spill stores, 92 bytes spill loads

2025-11-06 15:04:44.828098: I external/local_xla/xla/stream_executor/cuda/subprocess_compilation.cc:346] ptxas warning : Registers are spilled to local memory in function &#39;gemm_fusion_dot_114&#39;, 148 bytes spill stores, 148 bytes spill loads

2025-11-06 15:04:44.944060: W external/local_xla/xla/tsl/framework/bfc_allocator.cc:310] Allocator (GPU_0_bfc) ran out of memory trying to allocate 10.44GiB with freed_by_count=0. The caller indicates that this is not a failure, but this may mean that there could be performance gains if more memory were available.
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span><span class=" -Color -Color-Bold">30/30</span> <span class=" -Color -Color-Green">â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”</span> <span class=" -Color -Color-Bold">14s</span> 248ms/step - accuracy: 0.0410 - loss: 6.3958 - val_accuracy: 0.0588 - val_loss: 3.1757 - learning_rate: 1.0000e-04
Epoch 2/40
<span class=" -Color -Color-Bold">30/30</span> <span class=" -Color -Color-Green">â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”</span> <span class=" -Color -Color-Bold">0s</span> 5ms/step - accuracy: 0.0588 - loss: 4.7977 - val_accuracy: 0.0441 - val_loss: 3.1762 - learning_rate: 1.0000e-04
Epoch 3/40
<span class=" -Color -Color-Bold">30/30</span> <span class=" -Color -Color-Green">â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”</span> <span class=" -Color -Color-Bold">0s</span> 5ms/step - accuracy: 0.0867 - loss: 3.9411 - val_accuracy: 0.0613 - val_loss: 3.1765 - learning_rate: 1.0000e-04
Epoch 4/40
<span class=" -Color -Color-Bold">30/30</span> <span class=" -Color -Color-Green">â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”</span> <span class=" -Color -Color-Bold">0s</span> 5ms/step - accuracy: 0.0982 - loss: 3.4923 - val_accuracy: 0.0637 - val_loss: 3.1739 - learning_rate: 1.0000e-04
Epoch 5/40
<span class=" -Color -Color-Bold">30/30</span> <span class=" -Color -Color-Green">â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”</span> <span class=" -Color -Color-Bold">0s</span> 6ms/step - accuracy: 0.1229 - loss: 3.2104 - val_accuracy: 0.0784 - val_loss: 3.1676 - learning_rate: 1.0000e-04
Epoch 6/40
<span class=" -Color -Color-Bold">30/30</span> <span class=" -Color -Color-Green">â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”</span> <span class=" -Color -Color-Bold">0s</span> 5ms/step - accuracy: 0.1586 - loss: 2.9814 - val_accuracy: 0.0858 - val_loss: 3.1562 - learning_rate: 1.0000e-04
Epoch 7/40
<span class=" -Color -Color-Bold">30/30</span> <span class=" -Color -Color-Green">â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”</span> <span class=" -Color -Color-Bold">0s</span> 5ms/step - accuracy: 0.1843 - loss: 2.8366 - val_accuracy: 0.1054 - val_loss: 3.1404 - learning_rate: 1.0000e-04
Epoch 8/40
<span class=" -Color -Color-Bold">30/30</span> <span class=" -Color -Color-Green">â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”</span> <span class=" -Color -Color-Bold">0s</span> 5ms/step - accuracy: 0.2027 - loss: 2.7711 - val_accuracy: 0.1348 - val_loss: 3.1209 - learning_rate: 1.0000e-04
Epoch 9/40
<span class=" -Color -Color-Bold">30/30</span> <span class=" -Color -Color-Green">â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”</span> <span class=" -Color -Color-Bold">0s</span> 5ms/step - accuracy: 0.2342 - loss: 2.6879 - val_accuracy: 0.1740 - val_loss: 3.0987 - learning_rate: 1.0000e-04
Epoch 10/40
<span class=" -Color -Color-Bold">30/30</span> <span class=" -Color -Color-Green">â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”</span> <span class=" -Color -Color-Bold">0s</span> 5ms/step - accuracy: 0.2526 - loss: 2.6111 - val_accuracy: 0.1985 - val_loss: 3.0734 - learning_rate: 1.0000e-04
Epoch 11/40
<span class=" -Color -Color-Bold">30/30</span> <span class=" -Color -Color-Green">â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”</span> <span class=" -Color -Color-Bold">0s</span> 5ms/step - accuracy: 0.2778 - loss: 2.5200 - val_accuracy: 0.2279 - val_loss: 3.0415 - learning_rate: 1.0000e-04
Epoch 12/40
<span class=" -Color -Color-Bold">30/30</span> <span class=" -Color -Color-Green">â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”</span> <span class=" -Color -Color-Bold">0s</span> 5ms/step - accuracy: 0.2910 - loss: 2.4610 - val_accuracy: 0.2672 - val_loss: 3.0060 - learning_rate: 1.0000e-04
Epoch 13/40
<span class=" -Color -Color-Bold">30/30</span> <span class=" -Color -Color-Green">â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”</span> <span class=" -Color -Color-Bold">0s</span> 7ms/step - accuracy: 0.3272 - loss: 2.3927 - val_accuracy: 0.2672 - val_loss: 2.9590 - learning_rate: 1.0000e-04
Epoch 14/40
<span class=" -Color -Color-Bold">30/30</span> <span class=" -Color -Color-Green">â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”</span> <span class=" -Color -Color-Bold">0s</span> 6ms/step - accuracy: 0.3487 - loss: 2.3278 - val_accuracy: 0.2868 - val_loss: 2.9030 - learning_rate: 1.0000e-04
Epoch 15/40
<span class=" -Color -Color-Bold">30/30</span> <span class=" -Color -Color-Green">â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”</span> <span class=" -Color -Color-Bold">0s</span> 5ms/step - accuracy: 0.3592 - loss: 2.2710 - val_accuracy: 0.2892 - val_loss: 2.8450 - learning_rate: 1.0000e-04
Epoch 16/40
<span class=" -Color -Color-Bold">30/30</span> <span class=" -Color -Color-Green">â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”</span> <span class=" -Color -Color-Bold">0s</span> 5ms/step - accuracy: 0.3650 - loss: 2.1892 - val_accuracy: 0.2868 - val_loss: 2.7890 - learning_rate: 1.0000e-04
Epoch 17/40
<span class=" -Color -Color-Bold">30/30</span> <span class=" -Color -Color-Green">â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”</span> <span class=" -Color -Color-Bold">0s</span> 5ms/step - accuracy: 0.3955 - loss: 2.1370 - val_accuracy: 0.3015 - val_loss: 2.7261 - learning_rate: 1.0000e-04
Epoch 18/40
<span class=" -Color -Color-Bold">30/30</span> <span class=" -Color -Color-Green">â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”</span> <span class=" -Color -Color-Bold">0s</span> 5ms/step - accuracy: 0.4070 - loss: 2.0488 - val_accuracy: 0.2917 - val_loss: 2.6626 - learning_rate: 1.0000e-04
Epoch 19/40
<span class=" -Color -Color-Bold">30/30</span> <span class=" -Color -Color-Green">â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”</span> <span class=" -Color -Color-Bold">0s</span> 5ms/step - accuracy: 0.4328 - loss: 1.9909 - val_accuracy: 0.2990 - val_loss: 2.6077 - learning_rate: 1.0000e-04
Epoch 20/40
<span class=" -Color -Color-Bold">30/30</span> <span class=" -Color -Color-Green">â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”</span> <span class=" -Color -Color-Bold">0s</span> 5ms/step - accuracy: 0.4543 - loss: 1.9407 - val_accuracy: 0.3015 - val_loss: 2.5519 - learning_rate: 1.0000e-04
Epoch 21/40
<span class=" -Color -Color-Bold">30/30</span> <span class=" -Color -Color-Green">â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”</span> <span class=" -Color -Color-Bold">0s</span> 5ms/step - accuracy: 0.4606 - loss: 1.8589 - val_accuracy: 0.3064 - val_loss: 2.5111 - learning_rate: 1.0000e-04
Epoch 22/40
<span class=" -Color -Color-Bold">30/30</span> <span class=" -Color -Color-Green">â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”</span> <span class=" -Color -Color-Bold">0s</span> 5ms/step - accuracy: 0.4837 - loss: 1.8376 - val_accuracy: 0.3235 - val_loss: 2.4783 - learning_rate: 1.0000e-04
Epoch 23/40
<span class=" -Color -Color-Bold">30/30</span> <span class=" -Color -Color-Green">â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”</span> <span class=" -Color -Color-Bold">0s</span> 5ms/step - accuracy: 0.4884 - loss: 1.7900 - val_accuracy: 0.3358 - val_loss: 2.4405 - learning_rate: 1.0000e-04
Epoch 24/40
<span class=" -Color -Color-Bold">30/30</span> <span class=" -Color -Color-Green">â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”</span> <span class=" -Color -Color-Bold">0s</span> 5ms/step - accuracy: 0.5121 - loss: 1.7359 - val_accuracy: 0.3358 - val_loss: 2.4250 - learning_rate: 1.0000e-04
Epoch 25/40
<span class=" -Color -Color-Bold">30/30</span> <span class=" -Color -Color-Green">â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”</span> <span class=" -Color -Color-Bold">0s</span> 5ms/step - accuracy: 0.5357 - loss: 1.6813 - val_accuracy: 0.3358 - val_loss: 2.3974 - learning_rate: 1.0000e-04
Epoch 26/40
<span class=" -Color -Color-Bold">30/30</span> <span class=" -Color -Color-Green">â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”</span> <span class=" -Color -Color-Bold">0s</span> 5ms/step - accuracy: 0.5305 - loss: 1.6379 - val_accuracy: 0.3382 - val_loss: 2.3736 - learning_rate: 1.0000e-04
Epoch 27/40
<span class=" -Color -Color-Bold">30/30</span> <span class=" -Color -Color-Green">â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”</span> <span class=" -Color -Color-Bold">0s</span> 5ms/step - accuracy: 0.5530 - loss: 1.5819 - val_accuracy: 0.3407 - val_loss: 2.3538 - learning_rate: 1.0000e-04
Epoch 28/40
<span class=" -Color -Color-Bold">30/30</span> <span class=" -Color -Color-Green">â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”</span> <span class=" -Color -Color-Bold">0s</span> 5ms/step - accuracy: 0.5819 - loss: 1.5368 - val_accuracy: 0.3676 - val_loss: 2.3415 - learning_rate: 1.0000e-04
Epoch 29/40
<span class=" -Color -Color-Bold">30/30</span> <span class=" -Color -Color-Green">â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”</span> <span class=" -Color -Color-Bold">0s</span> 5ms/step - accuracy: 0.5951 - loss: 1.4665 - val_accuracy: 0.3603 - val_loss: 2.3230 - learning_rate: 1.0000e-04
Epoch 30/40
<span class=" -Color -Color-Bold">30/30</span> <span class=" -Color -Color-Green">â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”</span> <span class=" -Color -Color-Bold">0s</span> 5ms/step - accuracy: 0.6229 - loss: 1.4035 - val_accuracy: 0.3652 - val_loss: 2.3086 - learning_rate: 1.0000e-04
Epoch 31/40
<span class=" -Color -Color-Bold">30/30</span> <span class=" -Color -Color-Green">â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”</span> <span class=" -Color -Color-Bold">0s</span> 5ms/step - accuracy: 0.6155 - loss: 1.3745 - val_accuracy: 0.3676 - val_loss: 2.3030 - learning_rate: 1.0000e-04
Epoch 32/40
<span class=" -Color -Color-Bold">30/30</span> <span class=" -Color -Color-Green">â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”</span> <span class=" -Color -Color-Bold">0s</span> 5ms/step - accuracy: 0.6397 - loss: 1.3318 - val_accuracy: 0.3775 - val_loss: 2.3038 - learning_rate: 1.0000e-04
Epoch 33/40
<span class=" -Color -Color-Bold">30/30</span> <span class=" -Color -Color-Green">â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”</span> <span class=" -Color -Color-Bold">0s</span> 5ms/step - accuracy: 0.6313 - loss: 1.3196 - val_accuracy: 0.3725 - val_loss: 2.2936 - learning_rate: 1.0000e-04
Epoch 34/40
<span class=" -Color -Color-Bold">30/30</span> <span class=" -Color -Color-Green">â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”</span> <span class=" -Color -Color-Bold">0s</span> 5ms/step - accuracy: 0.6549 - loss: 1.2382 - val_accuracy: 0.3701 - val_loss: 2.2882 - learning_rate: 1.0000e-04
Epoch 35/40
<span class=" -Color -Color-Bold">30/30</span> <span class=" -Color -Color-Green">â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”</span> <span class=" -Color -Color-Bold">0s</span> 6ms/step - accuracy: 0.6534 - loss: 1.2210 - val_accuracy: 0.3775 - val_loss: 2.2759 - learning_rate: 1.0000e-04
Epoch 36/40
<span class=" -Color -Color-Bold">30/30</span> <span class=" -Color -Color-Green">â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”</span> <span class=" -Color -Color-Bold">0s</span> 5ms/step - accuracy: 0.7064 - loss: 1.1221 - val_accuracy: 0.3505 - val_loss: 2.2722 - learning_rate: 1.0000e-04
Epoch 37/40
<span class=" -Color -Color-Bold">30/30</span> <span class=" -Color -Color-Green">â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”</span> <span class=" -Color -Color-Bold">0s</span> 5ms/step - accuracy: 0.7122 - loss: 1.0860 - val_accuracy: 0.3701 - val_loss: 2.2683 - learning_rate: 1.0000e-04
Epoch 38/40
<span class=" -Color -Color-Bold">30/30</span> <span class=" -Color -Color-Green">â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”</span> <span class=" -Color -Color-Bold">0s</span> 5ms/step - accuracy: 0.7101 - loss: 1.0799 - val_accuracy: 0.3627 - val_loss: 2.2681 - learning_rate: 1.0000e-04
Epoch 39/40
<span class=" -Color -Color-Bold">30/30</span> <span class=" -Color -Color-Green">â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”</span> <span class=" -Color -Color-Bold">0s</span> 5ms/step - accuracy: 0.7206 - loss: 1.0307 - val_accuracy: 0.3725 - val_loss: 2.2701 - learning_rate: 1.0000e-04
Epoch 40/40
<span class=" -Color -Color-Bold">30/30</span> <span class=" -Color -Color-Green">â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”</span> <span class=" -Color -Color-Bold">0s</span> 5ms/step - accuracy: 0.7384 - loss: 0.9827 - val_accuracy: 0.3701 - val_loss: 2.2666 - learning_rate: 1.0000e-04
â±ï¸ Tiempo total de entrenamiento: 20.39 segundos
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># ======================================================</span>
<span class="c1"># ðŸ” EvaluaciÃ³n del modelo CNN-1D</span>
<span class="c1"># ======================================================</span>
<span class="n">t_eval_0</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
<span class="n">y_pred_proba</span> <span class="o">=</span> <span class="n">cnn_model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test_pad</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">y_pred</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">y_pred_proba</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">t_eval_1</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>

<span class="c1"># ======================================================</span>
<span class="c1"># ðŸ“ MÃ©tricas de desempeÃ±o</span>
<span class="c1"># ======================================================</span>
<span class="n">accuracy</span>  <span class="o">=</span> <span class="n">accuracy_score</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)</span>
<span class="n">precision</span> <span class="o">=</span> <span class="n">precision_score</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">,</span> <span class="n">average</span><span class="o">=</span><span class="s1">&#39;macro&#39;</span><span class="p">,</span> <span class="n">zero_division</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">recall</span>    <span class="o">=</span> <span class="n">recall_score</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">,</span> <span class="n">average</span><span class="o">=</span><span class="s1">&#39;macro&#39;</span><span class="p">,</span> <span class="n">zero_division</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">f1</span>        <span class="o">=</span> <span class="n">f1_score</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">,</span> <span class="n">average</span><span class="o">=</span><span class="s1">&#39;macro&#39;</span><span class="p">,</span> <span class="n">zero_division</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

<span class="k">try</span><span class="p">:</span>
    <span class="n">roc_auc</span> <span class="o">=</span> <span class="n">roc_auc_score</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred_proba</span><span class="p">,</span> <span class="n">multi_class</span><span class="o">=</span><span class="s1">&#39;ovr&#39;</span><span class="p">,</span> <span class="n">average</span><span class="o">=</span><span class="s1">&#39;macro&#39;</span><span class="p">)</span>
<span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
    <span class="n">roc_auc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;âš ï¸ No se pudo calcular ROC-AUC: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># ======================================================</span>
<span class="c1"># ðŸ“ˆ Resultados finales</span>
<span class="c1"># ======================================================</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">ðŸ“Š Resultados finales CNN-1D:&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;   Accuracy:          </span><span class="si">{</span><span class="n">accuracy</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;   Precision (Macro): </span><span class="si">{</span><span class="n">precision</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;   Recall (Macro):    </span><span class="si">{</span><span class="n">recall</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;   F1-Score (Macro):  </span><span class="si">{</span><span class="n">f1</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;   ROC-AUC (OvR):     </span><span class="si">{</span><span class="n">roc_auc</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;   Tiempo entrenamiento: </span><span class="si">{</span><span class="n">train_time_cnn</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> s&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;   Tiempo evaluaciÃ³n:   </span><span class="si">{</span><span class="n">t_eval_1</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">t_eval_0</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> s&quot;</span><span class="p">)</span>

<span class="c1"># ======================================================</span>
<span class="c1"># ðŸ’¾ Guardar resultados</span>
<span class="c1"># ======================================================</span>
<span class="n">df_metrics_cnn</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">([{</span>
    <span class="s2">&quot;Accuracy&quot;</span><span class="p">:</span> <span class="n">accuracy</span><span class="p">,</span>
    <span class="s2">&quot;Precision (Macro)&quot;</span><span class="p">:</span> <span class="n">precision</span><span class="p">,</span>
    <span class="s2">&quot;Recall (Macro)&quot;</span><span class="p">:</span> <span class="n">recall</span><span class="p">,</span>
    <span class="s2">&quot;F1-Score (Macro)&quot;</span><span class="p">:</span> <span class="n">f1</span><span class="p">,</span>
    <span class="s2">&quot;Train Time (s)&quot;</span><span class="p">:</span> <span class="n">train_time_cnn</span><span class="p">,</span>
    <span class="s2">&quot;ROC-AUC (OvR)&quot;</span><span class="p">:</span> <span class="n">roc_auc</span>
<span class="p">}])</span>

<span class="n">display</span><span class="p">(</span><span class="n">df_metrics_cnn</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-11-06 15:05:25.090758: W external/local_xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2025-11-06 15:05:25.090798: W external/local_xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2025-11-06 15:05:25.625818: I external/local_xla/xla/stream_executor/cuda/subprocess_compilation.cc:346] ptxas warning : Registers are spilled to local memory in function &#39;gemm_fusion_dot_90&#39;, 80 bytes spill stores, 80 bytes spill loads

2025-11-06 15:05:25.716468: I external/local_xla/xla/stream_executor/cuda/subprocess_compilation.cc:346] ptxas warning : Registers are spilled to local memory in function &#39;gemm_fusion_dot_83&#39;, 24 bytes spill stores, 24 bytes spill loads

2025-11-06 15:05:25.767148: I external/local_xla/xla/stream_executor/cuda/subprocess_compilation.cc:346] ptxas warning : Registers are spilled to local memory in function &#39;gemm_fusion_dot_83&#39;, 32 bytes spill stores, 32 bytes spill loads

2025-11-06 15:05:25.782058: I external/local_xla/xla/stream_executor/cuda/subprocess_compilation.cc:346] ptxas warning : Registers are spilled to local memory in function &#39;gemm_fusion_dot_90&#39;, 92 bytes spill stores, 92 bytes spill loads

2025-11-06 15:05:25.787076: I external/local_xla/xla/stream_executor/cuda/subprocess_compilation.cc:346] ptxas warning : Registers are spilled to local memory in function &#39;gemm_fusion_dot_90&#39;, 72 bytes spill stores, 72 bytes spill loads

2025-11-06 15:05:25.806527: I external/local_xla/xla/stream_executor/cuda/subprocess_compilation.cc:346] ptxas warning : Registers are spilled to local memory in function &#39;gemm_fusion_dot_90&#39;, 120 bytes spill stores, 120 bytes spill loads

2025-11-06 15:05:25.969468: W external/local_xla/xla/tsl/framework/bfc_allocator.cc:310] Allocator (GPU_0_bfc) ran out of memory trying to allocate 10.74GiB with freed_by_count=0. The caller indicates that this is not a failure, but this may mean that there could be performance gains if more memory were available.
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span><span class=" -Color -Color-Bold">13/13</span> <span class=" -Color -Color-Green">â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”</span> <span class=" -Color -Color-Bold">2s</span> 42ms/step

ðŸ“Š Resultados finales CNN-1D:
   Accuracy:          0.3676
   Precision (Macro): 0.3681
   Recall (Macro):    0.3639
   F1-Score (Macro):  0.3604
   ROC-AUC (OvR):     0.8379
   Tiempo entrenamiento: 20.39 s
   Tiempo evaluaciÃ³n:   1.96 s
</pre></div>
</div>
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Accuracy</th>
      <th>Precision (Macro)</th>
      <th>Recall (Macro)</th>
      <th>F1-Score (Macro)</th>
      <th>Train Time (s)</th>
      <th>ROC-AUC (OvR)</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0.367647</td>
      <td>0.368105</td>
      <td>0.363933</td>
      <td>0.360398</td>
      <td>20.39</td>
      <td>0.837887</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df_metrics_cnn</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s2">&quot;resultados_cnn1d_fasttext.csv&quot;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">ðŸ’¾ Resultados guardados en &#39;resultados_cnn1d_fasttext.csv&#39;&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>ðŸ’¾ Resultados guardados en &#39;resultados_cnn1d_fasttext.csv&#39;
</pre></div>
</div>
</div>
</div>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="tf-idf-xgboost-con-gpu">
<h1>TF-IDF + XGBoost con GPU<a class="headerlink" href="#tf-idf-xgboost-con-gpu" title="Permalink to this heading">#</a></h1>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">re</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">nltk</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">nltk.corpus</span><span class="w"> </span><span class="kn">import</span> <span class="n">stopwords</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">nltk.tokenize</span><span class="w"> </span><span class="kn">import</span> <span class="n">word_tokenize</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">sklearn.model_selection</span><span class="w"> </span><span class="kn">import</span> <span class="n">train_test_split</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">sklearn.preprocessing</span><span class="w"> </span><span class="kn">import</span> <span class="n">LabelEncoder</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">sklearn.feature_extraction.text</span><span class="w"> </span><span class="kn">import</span> <span class="n">TfidfVectorizer</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">sklearn.metrics</span><span class="w"> </span><span class="kn">import</span> <span class="n">classification_report</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">xgboost</span><span class="w"> </span><span class="kn">import</span> <span class="n">XGBClassifier</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">SEED</span> <span class="o">=</span> <span class="mi">42</span>
<span class="n">nltk</span><span class="o">.</span><span class="n">download</span><span class="p">(</span><span class="s1">&#39;punkt&#39;</span><span class="p">,</span> <span class="n">quiet</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">nltk</span><span class="o">.</span><span class="n">download</span><span class="p">(</span><span class="s1">&#39;stopwords&#39;</span><span class="p">,</span> <span class="n">quiet</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">STOPWORDS</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">stopwords</span><span class="o">.</span><span class="n">words</span><span class="p">(</span><span class="s2">&quot;english&quot;</span><span class="p">))</span>

<span class="c1"># ===========================================================</span>
<span class="c1"># ðŸ§¹ Cargar y limpiar texto</span>
<span class="c1"># ===========================================================</span>
<span class="n">PATH</span> <span class="o">=</span> <span class="s2">&quot;dataset_EDA_completo.csv&quot;</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">PATH</span><span class="p">)</span>

<span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[[</span><span class="s1">&#39;clean_text&#39;</span><span class="p">,</span> <span class="s1">&#39;category&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>
<span class="n">df</span><span class="p">[</span><span class="s1">&#39;clean_text&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;clean_text&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="k">else</span> <span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>

<span class="k">def</span><span class="w"> </span><span class="nf">clean_text</span><span class="p">(</span><span class="n">text</span><span class="p">):</span>
    <span class="n">text</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;http\S+|www\S+&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">text</span><span class="p">)</span>
    <span class="n">text</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;[^a-zA-Z&#39;]&quot;</span><span class="p">,</span> <span class="s2">&quot; &quot;</span><span class="p">,</span> <span class="n">text</span><span class="o">.</span><span class="n">lower</span><span class="p">())</span>
    <span class="n">tokens</span> <span class="o">=</span> <span class="n">word_tokenize</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
    <span class="n">tokens</span> <span class="o">=</span> <span class="p">[</span><span class="n">t</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">tokens</span> <span class="k">if</span> <span class="n">t</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">STOPWORDS</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">t</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">]</span>
    <span class="k">return</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">tokens</span><span class="p">)</span>

<span class="n">df</span><span class="p">[</span><span class="s1">&#39;clean_text&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;clean_text&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">clean_text</span><span class="p">)</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;clean_text&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">len</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># ===========================================================</span>
<span class="c1"># ðŸ·ï¸ Codificar etiquetas</span>
<span class="c1"># ===========================================================</span>
<span class="n">le</span> <span class="o">=</span> <span class="n">LabelEncoder</span><span class="p">()</span>
<span class="n">df</span><span class="p">[</span><span class="s1">&#39;y&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">le</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;category&#39;</span><span class="p">])</span>
<span class="n">num_classes</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;y&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">nunique</span><span class="p">()</span>

<span class="c1"># ===========================================================</span>
<span class="c1"># âœ‚ï¸ Split datasets</span>
<span class="c1"># ===========================================================</span>
<span class="n">X_train</span><span class="p">,</span> <span class="n">X_tmp</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">y_tmp</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span>
    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;clean_text&#39;</span><span class="p">],</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;y&#39;</span><span class="p">],</span> <span class="n">test_size</span><span class="o">=</span><span class="mf">0.30</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="n">SEED</span><span class="p">,</span> <span class="n">stratify</span><span class="o">=</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;y&#39;</span><span class="p">]</span>
<span class="p">)</span>
<span class="n">X_val</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_val</span><span class="p">,</span> <span class="n">y_test</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span>
    <span class="n">X_tmp</span><span class="p">,</span> <span class="n">y_tmp</span><span class="p">,</span> <span class="n">test_size</span><span class="o">=</span><span class="mf">0.50</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="n">SEED</span><span class="p">,</span> <span class="n">stratify</span><span class="o">=</span><span class="n">y_tmp</span>
<span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Train: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">X_train</span><span class="p">)</span><span class="si">}</span><span class="s2"> | Val: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">X_val</span><span class="p">)</span><span class="si">}</span><span class="s2"> | Test: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span><span class="si">}</span><span class="s2"> | Clases: </span><span class="si">{</span><span class="n">num_classes</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Train: 1904 | Val: 408 | Test: 408 | Clases: 24
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># ===========================================================</span>
<span class="c1"># ðŸ”¤ TF-IDF</span>
<span class="c1"># ===========================================================</span>
<span class="n">vectorizer</span> <span class="o">=</span> <span class="n">TfidfVectorizer</span><span class="p">(</span><span class="n">max_features</span><span class="o">=</span><span class="mi">10000</span><span class="p">,</span> <span class="n">ngram_range</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">),</span> <span class="n">sublinear_tf</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">X_train_tfidf</span> <span class="o">=</span> <span class="n">vectorizer</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">X_train</span><span class="p">)</span>
<span class="n">X_val_tfidf</span>   <span class="o">=</span> <span class="n">vectorizer</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">X_val</span><span class="p">)</span>
<span class="n">X_test_tfidf</span>  <span class="o">=</span> <span class="n">vectorizer</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">time</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">sklearn.metrics</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
    <span class="n">accuracy_score</span><span class="p">,</span> <span class="n">precision_score</span><span class="p">,</span> <span class="n">recall_score</span><span class="p">,</span> <span class="n">f1_score</span><span class="p">,</span> <span class="n">roc_auc_score</span>
<span class="p">)</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>

<span class="c1"># ===========================================================</span>
<span class="c1"># âš™ï¸ Entrenamiento con temporizador</span>
<span class="c1"># ===========================================================</span>
<span class="n">t_train_0</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>

<span class="n">model</span> <span class="o">=</span> <span class="n">XGBClassifier</span><span class="p">(</span>
    <span class="n">objective</span><span class="o">=</span><span class="s2">&quot;multi:softprob&quot;</span><span class="p">,</span>   <span class="c1"># importante</span>
    <span class="n">num_class</span><span class="o">=</span><span class="n">num_classes</span><span class="p">,</span>
    <span class="n">eval_metric</span><span class="o">=</span><span class="s2">&quot;mlogloss&quot;</span><span class="p">,</span>
    <span class="n">tree_method</span><span class="o">=</span><span class="s2">&quot;hist&quot;</span><span class="p">,</span>
    <span class="n">device</span><span class="o">=</span><span class="s2">&quot;cuda&quot;</span><span class="p">,</span>
    <span class="n">random_state</span><span class="o">=</span><span class="n">SEED</span><span class="p">,</span>
    <span class="n">learning_rate</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span>
    <span class="n">n_estimators</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span>
    <span class="n">max_depth</span><span class="o">=</span><span class="mi">6</span>
<span class="p">)</span>
<span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span>
    <span class="n">X_train_tfidf</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span>
    <span class="n">eval_set</span><span class="o">=</span><span class="p">[(</span><span class="n">X_val_tfidf</span><span class="p">,</span> <span class="n">y_val</span><span class="p">)],</span>
    <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span>
<span class="p">)</span>

<span class="n">t_train_1</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
<span class="n">train_time_s</span> <span class="o">=</span> <span class="n">t_train_1</span> <span class="o">-</span> <span class="n">t_train_0</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">â±ï¸ Tiempo total de entrenamiento: </span><span class="si">{</span><span class="n">train_time_s</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> s&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[0]	validation_0-mlogloss:2.68413
[1]	validation_0-mlogloss:2.36311
[2]	validation_0-mlogloss:2.74673
[3]	validation_0-mlogloss:3.16538
[4]	validation_0-mlogloss:3.76375
[5]	validation_0-mlogloss:4.00142
[6]	validation_0-mlogloss:4.24540
[7]	validation_0-mlogloss:4.39064
[8]	validation_0-mlogloss:4.75565
[9]	validation_0-mlogloss:5.19918
[10]	validation_0-mlogloss:5.65568
[11]	validation_0-mlogloss:6.21327
[12]	validation_0-mlogloss:6.72532
[13]	validation_0-mlogloss:7.43753
[14]	validation_0-mlogloss:7.83652
[15]	validation_0-mlogloss:7.98482
[16]	validation_0-mlogloss:8.12469
[17]	validation_0-mlogloss:8.35824
[18]	validation_0-mlogloss:8.54252
[19]	validation_0-mlogloss:8.39802
[20]	validation_0-mlogloss:8.75452
[21]	validation_0-mlogloss:8.77872
[22]	validation_0-mlogloss:9.15248
[23]	validation_0-mlogloss:9.46680
[24]	validation_0-mlogloss:9.83586
[25]	validation_0-mlogloss:9.93657
[26]	validation_0-mlogloss:10.15471
[27]	validation_0-mlogloss:10.38542
[28]	validation_0-mlogloss:10.45680
[29]	validation_0-mlogloss:10.53030
[30]	validation_0-mlogloss:10.49763
[31]	validation_0-mlogloss:10.54900
[32]	validation_0-mlogloss:10.71267
[33]	validation_0-mlogloss:10.80446
[34]	validation_0-mlogloss:10.89654
[35]	validation_0-mlogloss:10.96900
[36]	validation_0-mlogloss:11.08812
[37]	validation_0-mlogloss:11.15940
[38]	validation_0-mlogloss:11.36712
[39]	validation_0-mlogloss:11.36523
[40]	validation_0-mlogloss:11.45048
[41]	validation_0-mlogloss:11.56199
[42]	validation_0-mlogloss:11.67587
[43]	validation_0-mlogloss:11.62888
[44]	validation_0-mlogloss:11.56697
[45]	validation_0-mlogloss:11.65432
[46]	validation_0-mlogloss:11.78775
[47]	validation_0-mlogloss:11.87782
[48]	validation_0-mlogloss:11.95773
[49]	validation_0-mlogloss:12.08504
[50]	validation_0-mlogloss:12.15166
[51]	validation_0-mlogloss:12.24993
[52]	validation_0-mlogloss:12.36622
[53]	validation_0-mlogloss:12.48322
[54]	validation_0-mlogloss:12.48995
[55]	validation_0-mlogloss:12.59952
[56]	validation_0-mlogloss:12.68625
[57]	validation_0-mlogloss:12.77781
[58]	validation_0-mlogloss:12.74825
[59]	validation_0-mlogloss:12.89061
[60]	validation_0-mlogloss:13.01584
[61]	validation_0-mlogloss:13.02697
[62]	validation_0-mlogloss:13.09316
[63]	validation_0-mlogloss:13.16366
[64]	validation_0-mlogloss:13.15833
[65]	validation_0-mlogloss:13.11888
[66]	validation_0-mlogloss:13.02968
[67]	validation_0-mlogloss:13.11677
[68]	validation_0-mlogloss:13.19703
[69]	validation_0-mlogloss:13.15556
[70]	validation_0-mlogloss:13.31096
[71]	validation_0-mlogloss:13.34793
[72]	validation_0-mlogloss:13.41579
[73]	validation_0-mlogloss:13.42704
[74]	validation_0-mlogloss:13.43377
[75]	validation_0-mlogloss:13.42678
[76]	validation_0-mlogloss:13.35220
[77]	validation_0-mlogloss:13.69628
[78]	validation_0-mlogloss:14.25022
[79]	validation_0-mlogloss:14.86908
[80]	validation_0-mlogloss:15.40542
[81]	validation_0-mlogloss:14.70328
[82]	validation_0-mlogloss:14.89554
[83]	validation_0-mlogloss:14.95859
[84]	validation_0-mlogloss:14.92490
[85]	validation_0-mlogloss:15.17526
[86]	validation_0-mlogloss:15.24380
[87]	validation_0-mlogloss:15.20614
[88]	validation_0-mlogloss:15.20575
[89]	validation_0-mlogloss:15.21990
[90]	validation_0-mlogloss:15.27662
[91]	validation_0-mlogloss:15.15518
[92]	validation_0-mlogloss:15.73373
[93]	validation_0-mlogloss:16.04507
[94]	validation_0-mlogloss:16.14493
[95]	validation_0-mlogloss:16.16624
[96]	validation_0-mlogloss:16.29863
[97]	validation_0-mlogloss:16.29508
[98]	validation_0-mlogloss:16.43460
[99]	validation_0-mlogloss:16.43803
[100]	validation_0-mlogloss:16.84611
[101]	validation_0-mlogloss:16.75379
[102]	validation_0-mlogloss:16.60937
[103]	validation_0-mlogloss:16.63860
[104]	validation_0-mlogloss:16.95262
[105]	validation_0-mlogloss:16.97555
[106]	validation_0-mlogloss:17.53564
[107]	validation_0-mlogloss:17.40989
[108]	validation_0-mlogloss:17.50081
[109]	validation_0-mlogloss:17.86585
[110]	validation_0-mlogloss:17.86585
[111]	validation_0-mlogloss:17.86585
[112]	validation_0-mlogloss:17.86585
[113]	validation_0-mlogloss:17.86585
[114]	validation_0-mlogloss:17.86585
[115]	validation_0-mlogloss:17.86585
[116]	validation_0-mlogloss:17.86585
[117]	validation_0-mlogloss:17.86585
[118]	validation_0-mlogloss:17.86585
[119]	validation_0-mlogloss:17.86585
[120]	validation_0-mlogloss:17.86585
[121]	validation_0-mlogloss:17.86585
[122]	validation_0-mlogloss:17.86585
[123]	validation_0-mlogloss:17.86585
[124]	validation_0-mlogloss:17.86585
[125]	validation_0-mlogloss:17.86585
[126]	validation_0-mlogloss:17.86585
[127]	validation_0-mlogloss:17.86585
[128]	validation_0-mlogloss:17.86585
[129]	validation_0-mlogloss:17.86585
[130]	validation_0-mlogloss:17.86585
[131]	validation_0-mlogloss:17.86585
[132]	validation_0-mlogloss:17.86585
[133]	validation_0-mlogloss:17.86585
[134]	validation_0-mlogloss:17.86585
[135]	validation_0-mlogloss:17.86585
[136]	validation_0-mlogloss:17.86585
[137]	validation_0-mlogloss:17.86585
[138]	validation_0-mlogloss:17.86585
[139]	validation_0-mlogloss:17.86585
[140]	validation_0-mlogloss:17.86585
[141]	validation_0-mlogloss:17.86585
[142]	validation_0-mlogloss:17.86585
[143]	validation_0-mlogloss:17.86585
[144]	validation_0-mlogloss:17.86585
[145]	validation_0-mlogloss:17.86585
[146]	validation_0-mlogloss:17.86585
[147]	validation_0-mlogloss:17.86585
[148]	validation_0-mlogloss:17.86585
[149]	validation_0-mlogloss:17.86585
[150]	validation_0-mlogloss:17.86585
[151]	validation_0-mlogloss:17.86585
[152]	validation_0-mlogloss:17.86585
[153]	validation_0-mlogloss:17.86585
[154]	validation_0-mlogloss:17.86585
[155]	validation_0-mlogloss:17.86585
[156]	validation_0-mlogloss:17.86585
[157]	validation_0-mlogloss:17.86585
[158]	validation_0-mlogloss:17.86585
[159]	validation_0-mlogloss:17.86585
[160]	validation_0-mlogloss:17.86585
[161]	validation_0-mlogloss:17.86585
[162]	validation_0-mlogloss:17.86585
[163]	validation_0-mlogloss:17.86585
[164]	validation_0-mlogloss:17.86585
[165]	validation_0-mlogloss:17.86585
[166]	validation_0-mlogloss:17.86585
[167]	validation_0-mlogloss:17.86585
[168]	validation_0-mlogloss:17.86585
[169]	validation_0-mlogloss:17.86585
[170]	validation_0-mlogloss:17.86585
[171]	validation_0-mlogloss:17.86585
[172]	validation_0-mlogloss:17.86585
[173]	validation_0-mlogloss:17.86585
[174]	validation_0-mlogloss:17.86585
[175]	validation_0-mlogloss:17.86585
[176]	validation_0-mlogloss:17.86585
[177]	validation_0-mlogloss:17.86585
[178]	validation_0-mlogloss:17.86585
[179]	validation_0-mlogloss:17.86585
[180]	validation_0-mlogloss:17.86585
[181]	validation_0-mlogloss:17.86585
[182]	validation_0-mlogloss:17.86585
[183]	validation_0-mlogloss:17.86585
[184]	validation_0-mlogloss:17.86585
[185]	validation_0-mlogloss:17.86585
[186]	validation_0-mlogloss:17.86585
[187]	validation_0-mlogloss:17.86585
[188]	validation_0-mlogloss:17.86585
[189]	validation_0-mlogloss:17.86585
[190]	validation_0-mlogloss:17.86585
[191]	validation_0-mlogloss:17.86585
[192]	validation_0-mlogloss:17.86585
[193]	validation_0-mlogloss:17.86585
[194]	validation_0-mlogloss:17.86585
[195]	validation_0-mlogloss:17.86585
[196]	validation_0-mlogloss:17.86585
[197]	validation_0-mlogloss:17.86585
[198]	validation_0-mlogloss:17.86585
[199]	validation_0-mlogloss:17.86585
[200]	validation_0-mlogloss:17.86585
[201]	validation_0-mlogloss:17.86585
[202]	validation_0-mlogloss:17.86585
[203]	validation_0-mlogloss:17.86585
[204]	validation_0-mlogloss:17.86585
[205]	validation_0-mlogloss:17.86585
[206]	validation_0-mlogloss:17.86585
[207]	validation_0-mlogloss:17.86585
[208]	validation_0-mlogloss:17.86585
[209]	validation_0-mlogloss:17.86585
[210]	validation_0-mlogloss:17.86585
[211]	validation_0-mlogloss:17.86585
[212]	validation_0-mlogloss:17.86585
[213]	validation_0-mlogloss:17.86585
[214]	validation_0-mlogloss:17.86585
[215]	validation_0-mlogloss:17.86585
[216]	validation_0-mlogloss:17.86585
[217]	validation_0-mlogloss:17.86585
[218]	validation_0-mlogloss:17.86585
[219]	validation_0-mlogloss:17.86585
[220]	validation_0-mlogloss:17.86585
[221]	validation_0-mlogloss:17.86585
[222]	validation_0-mlogloss:17.86585
[223]	validation_0-mlogloss:17.86585
[224]	validation_0-mlogloss:17.86585
[225]	validation_0-mlogloss:17.86585
[226]	validation_0-mlogloss:17.86585
[227]	validation_0-mlogloss:17.86585
[228]	validation_0-mlogloss:17.86585
[229]	validation_0-mlogloss:17.86585
[230]	validation_0-mlogloss:17.86585
[231]	validation_0-mlogloss:17.86585
[232]	validation_0-mlogloss:17.86585
[233]	validation_0-mlogloss:17.86585
[234]	validation_0-mlogloss:17.86585
[235]	validation_0-mlogloss:17.86585
[236]	validation_0-mlogloss:17.86585
[237]	validation_0-mlogloss:17.86585
[238]	validation_0-mlogloss:17.86585
[239]	validation_0-mlogloss:17.86585
[240]	validation_0-mlogloss:17.86585
[241]	validation_0-mlogloss:17.86585
[242]	validation_0-mlogloss:17.86585
[243]	validation_0-mlogloss:17.86585
[244]	validation_0-mlogloss:17.86585
[245]	validation_0-mlogloss:17.86585
[246]	validation_0-mlogloss:17.86585
[247]	validation_0-mlogloss:17.86585
[248]	validation_0-mlogloss:17.86585
[249]	validation_0-mlogloss:17.86585
[250]	validation_0-mlogloss:17.86585
[251]	validation_0-mlogloss:17.86585
[252]	validation_0-mlogloss:17.86585
[253]	validation_0-mlogloss:17.86585
[254]	validation_0-mlogloss:17.86585
[255]	validation_0-mlogloss:17.86585
[256]	validation_0-mlogloss:17.86585
[257]	validation_0-mlogloss:17.86585
[258]	validation_0-mlogloss:17.86585
[259]	validation_0-mlogloss:17.86585
[260]	validation_0-mlogloss:17.86585
[261]	validation_0-mlogloss:17.86585
[262]	validation_0-mlogloss:17.86585
[263]	validation_0-mlogloss:17.86585
[264]	validation_0-mlogloss:17.86585
[265]	validation_0-mlogloss:17.86585
[266]	validation_0-mlogloss:17.86585
[267]	validation_0-mlogloss:17.86585
[268]	validation_0-mlogloss:17.86585
[269]	validation_0-mlogloss:17.86585
[270]	validation_0-mlogloss:17.86585
[271]	validation_0-mlogloss:17.86585
[272]	validation_0-mlogloss:17.86585
[273]	validation_0-mlogloss:17.86585
[274]	validation_0-mlogloss:17.86585
[275]	validation_0-mlogloss:17.86585
[276]	validation_0-mlogloss:17.86585
[277]	validation_0-mlogloss:17.86585
[278]	validation_0-mlogloss:17.86585
[279]	validation_0-mlogloss:17.86585
[280]	validation_0-mlogloss:17.86585
[281]	validation_0-mlogloss:17.86585
[282]	validation_0-mlogloss:17.86585
[283]	validation_0-mlogloss:17.86585
[284]	validation_0-mlogloss:17.86585
[285]	validation_0-mlogloss:17.86585
[286]	validation_0-mlogloss:17.86585
[287]	validation_0-mlogloss:17.86585
[288]	validation_0-mlogloss:17.86585
[289]	validation_0-mlogloss:17.86585
[290]	validation_0-mlogloss:17.86585
[291]	validation_0-mlogloss:17.86585
[292]	validation_0-mlogloss:17.86585
[293]	validation_0-mlogloss:17.86585
[294]	validation_0-mlogloss:17.86585
[295]	validation_0-mlogloss:17.86585
[296]	validation_0-mlogloss:17.86585
[297]	validation_0-mlogloss:17.86585
[298]	validation_0-mlogloss:17.86585
[299]	validation_0-mlogloss:17.86585

â±ï¸ Tiempo total de entrenamiento: 20.55 s
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">sklearn.metrics</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
    <span class="n">accuracy_score</span><span class="p">,</span> <span class="n">precision_score</span><span class="p">,</span> <span class="n">recall_score</span><span class="p">,</span> <span class="n">f1_score</span><span class="p">,</span> <span class="n">roc_auc_score</span>
<span class="p">)</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">time</span>

<span class="c1"># ===========================================================</span>
<span class="c1"># ðŸ•’ EvaluaciÃ³n</span>
<span class="c1"># ===========================================================</span>
<span class="n">t_eval_0</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>

<span class="c1"># Predicciones de probabilidad (solo disponible con &#39;multi:softprob&#39;)</span>
<span class="n">y_pred_proba</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">predict_proba</span><span class="p">(</span><span class="n">X_test_tfidf</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;y_pred_proba shape:&quot;</span><span class="p">,</span> <span class="n">y_pred_proba</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>

<span class="c1"># ðŸ”¹ Si el modelo devuelve vector 1D, forzamos matriz one-hot</span>
<span class="k">if</span> <span class="n">y_pred_proba</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">sklearn.preprocessing</span><span class="w"> </span><span class="kn">import</span> <span class="n">label_binarize</span>
    <span class="n">y_pred_proba</span> <span class="o">=</span> <span class="n">label_binarize</span><span class="p">(</span><span class="n">y_pred_proba</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">),</span>
                                  <span class="n">classes</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">num_classes</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;âš ï¸ XGBoost devolviÃ³ vector 1D, convertido a matriz:&quot;</span><span class="p">,</span> <span class="n">y_pred_proba</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>

<span class="c1"># ðŸ”¹ Etiquetas finales</span>
<span class="n">y_pred</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">y_pred_proba</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="n">t_eval_1</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>

<span class="c1"># ===========================================================</span>
<span class="c1"># ðŸ“Š MÃ©tricas clÃ¡sicas</span>
<span class="c1"># ===========================================================</span>
<span class="n">accuracy</span>  <span class="o">=</span> <span class="n">accuracy_score</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)</span>
<span class="n">precision</span> <span class="o">=</span> <span class="n">precision_score</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">,</span> <span class="n">average</span><span class="o">=</span><span class="s1">&#39;macro&#39;</span><span class="p">,</span> <span class="n">zero_division</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">recall</span>    <span class="o">=</span> <span class="n">recall_score</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">,</span> <span class="n">average</span><span class="o">=</span><span class="s1">&#39;macro&#39;</span><span class="p">,</span> <span class="n">zero_division</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">f1</span>        <span class="o">=</span> <span class="n">f1_score</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">,</span> <span class="n">average</span><span class="o">=</span><span class="s1">&#39;macro&#39;</span><span class="p">,</span> <span class="n">zero_division</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

<span class="c1"># ===========================================================</span>
<span class="c1"># ðŸ’« ROC-AUC (solo si tienes probabilidades)</span>
<span class="c1"># ===========================================================</span>
<span class="k">try</span><span class="p">:</span>
    <span class="n">roc_auc</span> <span class="o">=</span> <span class="n">roc_auc_score</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred_proba</span><span class="p">,</span> <span class="n">multi_class</span><span class="o">=</span><span class="s1">&#39;ovr&#39;</span><span class="p">,</span> <span class="n">average</span><span class="o">=</span><span class="s1">&#39;macro&#39;</span><span class="p">)</span>
<span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
    <span class="n">roc_auc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;âš ï¸ No se pudo calcular ROC-AUC: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># ===========================================================</span>
<span class="c1"># ðŸ§® Mostrar resumen bonito</span>
<span class="c1"># ===========================================================</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">ðŸ“ˆ Resultados finales:&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;   Accuracy:          </span><span class="si">{</span><span class="n">accuracy</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;   Precision (Macro): </span><span class="si">{</span><span class="n">precision</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;   Recall (Macro):    </span><span class="si">{</span><span class="n">recall</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;   F1-Score (Macro):  </span><span class="si">{</span><span class="n">f1</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;   ROC-AUC (OvR):     </span><span class="si">{</span><span class="n">roc_auc</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;   Tiempo entrenamiento: </span><span class="si">{</span><span class="n">train_time_s</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> s&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;   Tiempo evaluaciÃ³n:   </span><span class="si">{</span><span class="n">t_eval_1</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">t_eval_0</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> s&quot;</span><span class="p">)</span>

<span class="c1"># ===========================================================</span>
<span class="c1"># ðŸ“Š Guardar en DataFrame (para tabla resumen)</span>
<span class="c1"># ===========================================================</span>
<span class="n">df_metrics</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">([{</span>
    <span class="s2">&quot;Accuracy&quot;</span><span class="p">:</span> <span class="n">accuracy</span><span class="p">,</span>
    <span class="s2">&quot;Precision (Macro)&quot;</span><span class="p">:</span> <span class="n">precision</span><span class="p">,</span>
    <span class="s2">&quot;Recall (Macro)&quot;</span><span class="p">:</span> <span class="n">recall</span><span class="p">,</span>
    <span class="s2">&quot;F1-Score (Macro)&quot;</span><span class="p">:</span> <span class="n">f1</span><span class="p">,</span>
    <span class="s2">&quot;ROC-AUC (OvR)&quot;</span><span class="p">:</span> <span class="n">roc_auc</span><span class="p">,</span>
    <span class="s2">&quot;Train Time (s)&quot;</span><span class="p">:</span> <span class="n">train_time_s</span><span class="p">,</span>
    <span class="s2">&quot;Eval Time (s)&quot;</span><span class="p">:</span> <span class="n">t_eval_1</span> <span class="o">-</span> <span class="n">t_eval_0</span>
<span class="p">}])</span>

<span class="n">display</span><span class="p">(</span><span class="n">df_metrics</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>y_pred_proba shape: (408, 24)

ðŸ“ˆ Resultados finales:
   Accuracy:          0.4510
   Precision (Macro): 0.4947
   Recall (Macro):    0.4470
   F1-Score (Macro):  0.4106
   ROC-AUC (OvR):     0.8521
   Tiempo entrenamiento: 20.55 s
   Tiempo evaluaciÃ³n:   0.20 s
</pre></div>
</div>
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Accuracy</th>
      <th>Precision (Macro)</th>
      <th>Recall (Macro)</th>
      <th>F1-Score (Macro)</th>
      <th>ROC-AUC (OvR)</th>
      <th>Train Time (s)</th>
      <th>Eval Time (s)</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0.45098</td>
      <td>0.494732</td>
      <td>0.447008</td>
      <td>0.410594</td>
      <td>0.852114</td>
      <td>20.551007</td>
      <td>0.19954</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">seaborn</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">sns</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">sklearn.metrics</span><span class="w"> </span><span class="kn">import</span> <span class="n">confusion_matrix</span>

<span class="c1"># ===========================================================</span>
<span class="c1"># ðŸŽ¨ Heatmap de matriz de confusiÃ³n</span>
<span class="c1"># ===========================================================</span>
<span class="n">cm</span> <span class="o">=</span> <span class="n">confusion_matrix</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)</span>
<span class="n">cm_normalized</span> <span class="o">=</span> <span class="n">cm</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;float&#39;</span><span class="p">)</span> <span class="o">/</span> <span class="n">cm</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)[:,</span> <span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>
<span class="n">sns</span><span class="o">.</span><span class="n">heatmap</span><span class="p">(</span><span class="n">cm_normalized</span><span class="p">,</span>
            <span class="n">annot</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">fmt</span><span class="o">=</span><span class="s2">&quot;.2f&quot;</span><span class="p">,</span>
            <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;mako&quot;</span><span class="p">,</span>
            <span class="n">xticklabels</span><span class="o">=</span><span class="n">le</span><span class="o">.</span><span class="n">classes_</span><span class="p">,</span>
            <span class="n">yticklabels</span><span class="o">=</span><span class="n">le</span><span class="o">.</span><span class="n">classes_</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;ðŸ” Matriz de ConfusiÃ³n Normalizada (XGBoost GPU)&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="s2">&quot;bold&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;PredicciÃ³n&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Etiqueta Real&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">rotation</span><span class="o">=</span><span class="mi">45</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;right&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">yticks</span><span class="p">(</span><span class="n">rotation</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/tmp/ipykernel_279001/1999606607.py:24: UserWarning: Glyph 128269 (\N{LEFT-POINTING MAGNIFYING GLASS}) missing from font(s) DejaVu Sans.
  plt.tight_layout()
/home/nicoplayz/tf312/lib/python3.12/site-packages/IPython/core/pylabtools.py:170: UserWarning: Glyph 128269 (\N{LEFT-POINTING MAGNIFYING GLASS}) missing from font(s) DejaVu Sans.
  fig.canvas.print_figure(bytes_io, **kw)
</pre></div>
</div>
<img alt="_images/4a639c8e970cf660eb10e6f6a5036f9b7056a3f43991380576c046c1f2cdd496.png" src="_images/4a639c8e970cf660eb10e6f6a5036f9b7056a3f43991380576c046c1f2cdd496.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">datetime</span><span class="w"> </span><span class="kn">import</span> <span class="n">datetime</span>

<span class="c1"># ===========================================================</span>
<span class="c1"># ðŸ’¾ Guardar resultados en CSV con timestamp</span>
<span class="c1"># ===========================================================</span>
<span class="n">timestamp</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2">_%H-%M-%S&quot;</span><span class="p">)</span>
<span class="n">filename</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;metrics_xgboost_</span><span class="si">{</span><span class="n">timestamp</span><span class="si">}</span><span class="s2">.csv&quot;</span>

<span class="n">df_metrics</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf-8-sig&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;âœ… Resultados guardados en: </span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>âœ… Resultados guardados en: metrics_xgboost_2025-11-06_15-34-53.csv
</pre></div>
</div>
</div>
</div>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="fast-text-con-entrenamiento-local">
<h1>FAST TEXT con entrenamiento local<a class="headerlink" href="#fast-text-con-entrenamiento-local" title="Permalink to this heading">#</a></h1>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">tensorflow.keras.preprocessing.text</span><span class="w"> </span><span class="kn">import</span> <span class="n">Tokenizer</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">tensorflow.keras.preprocessing.sequence</span><span class="w"> </span><span class="kn">import</span> <span class="n">pad_sequences</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">tensorflow.keras.utils</span><span class="w"> </span><span class="kn">import</span> <span class="n">to_categorical</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>

<span class="c1"># TokenizaciÃ³n</span>
<span class="n">MAX_WORDS</span> <span class="o">=</span> <span class="mi">10000</span>
<span class="n">MAX_LEN</span> <span class="o">=</span> <span class="mi">200</span>

<span class="n">tokenizer</span> <span class="o">=</span> <span class="n">Tokenizer</span><span class="p">(</span><span class="n">num_words</span><span class="o">=</span><span class="n">MAX_WORDS</span><span class="p">,</span> <span class="n">oov_token</span><span class="o">=</span><span class="s2">&quot;&lt;OOV&gt;&quot;</span><span class="p">)</span>
<span class="n">tokenizer</span><span class="o">.</span><span class="n">fit_on_texts</span><span class="p">(</span><span class="n">X_train</span><span class="p">)</span>

<span class="n">X_train_seq</span> <span class="o">=</span> <span class="n">tokenizer</span><span class="o">.</span><span class="n">texts_to_sequences</span><span class="p">(</span><span class="n">X_train</span><span class="p">)</span>
<span class="n">X_val_seq</span>   <span class="o">=</span> <span class="n">tokenizer</span><span class="o">.</span><span class="n">texts_to_sequences</span><span class="p">(</span><span class="n">X_val</span><span class="p">)</span>
<span class="n">X_test_seq</span>  <span class="o">=</span> <span class="n">tokenizer</span><span class="o">.</span><span class="n">texts_to_sequences</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>

<span class="n">X_train_pad</span> <span class="o">=</span> <span class="n">pad_sequences</span><span class="p">(</span><span class="n">X_train_seq</span><span class="p">,</span> <span class="n">maxlen</span><span class="o">=</span><span class="n">MAX_LEN</span><span class="p">,</span> <span class="n">padding</span><span class="o">=</span><span class="s1">&#39;post&#39;</span><span class="p">,</span> <span class="n">truncating</span><span class="o">=</span><span class="s1">&#39;post&#39;</span><span class="p">)</span>
<span class="n">X_val_pad</span>   <span class="o">=</span> <span class="n">pad_sequences</span><span class="p">(</span><span class="n">X_val_seq</span><span class="p">,</span> <span class="n">maxlen</span><span class="o">=</span><span class="n">MAX_LEN</span><span class="p">,</span> <span class="n">padding</span><span class="o">=</span><span class="s1">&#39;post&#39;</span><span class="p">,</span> <span class="n">truncating</span><span class="o">=</span><span class="s1">&#39;post&#39;</span><span class="p">)</span>
<span class="n">X_test_pad</span>  <span class="o">=</span> <span class="n">pad_sequences</span><span class="p">(</span><span class="n">X_test_seq</span><span class="p">,</span> <span class="n">maxlen</span><span class="o">=</span><span class="n">MAX_LEN</span><span class="p">,</span> <span class="n">padding</span><span class="o">=</span><span class="s1">&#39;post&#39;</span><span class="p">,</span> <span class="n">truncating</span><span class="o">=</span><span class="s1">&#39;post&#39;</span><span class="p">)</span>

<span class="c1"># One-hot de etiquetas</span>
<span class="n">y_train_cat</span> <span class="o">=</span> <span class="n">to_categorical</span><span class="p">(</span><span class="n">y_train</span><span class="p">,</span> <span class="n">num_classes</span><span class="p">)</span>
<span class="n">y_val_cat</span>   <span class="o">=</span> <span class="n">to_categorical</span><span class="p">(</span><span class="n">y_val</span><span class="p">,</span> <span class="n">num_classes</span><span class="p">)</span>
<span class="n">y_test_cat</span>  <span class="o">=</span> <span class="n">to_categorical</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">num_classes</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-11-06 15:39:29.651401: I tensorflow/core/util/port.cc:153] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2025-11-06 15:39:30.340415: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX_VNNI, in other operations, rebuild TensorFlow with the appropriate compiler flags.
2025-11-06 15:39:32.856302: I tensorflow/core/util/port.cc:153] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">tensorflow.keras.models</span><span class="w"> </span><span class="kn">import</span> <span class="n">Sequential</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">tensorflow.keras.layers</span><span class="w"> </span><span class="kn">import</span> <span class="n">Embedding</span><span class="p">,</span> <span class="n">GlobalAveragePooling1D</span><span class="p">,</span> <span class="n">Dense</span>

<span class="k">def</span><span class="w"> </span><span class="nf">build_fasttext_model</span><span class="p">():</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">Sequential</span><span class="p">([</span>
        <span class="n">Embedding</span><span class="p">(</span><span class="n">input_dim</span><span class="o">=</span><span class="n">MAX_WORDS</span><span class="p">,</span> <span class="n">output_dim</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">input_length</span><span class="o">=</span><span class="n">MAX_LEN</span><span class="p">),</span>
        <span class="n">GlobalAveragePooling1D</span><span class="p">(),</span>
        <span class="n">Dense</span><span class="p">(</span><span class="mi">128</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s1">&#39;relu&#39;</span><span class="p">),</span>
        <span class="n">Dense</span><span class="p">(</span><span class="n">num_classes</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s1">&#39;softmax&#39;</span><span class="p">)</span>
    <span class="p">])</span>
    <span class="n">model</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span>
        <span class="n">optimizer</span><span class="o">=</span><span class="s1">&#39;adam&#39;</span><span class="p">,</span>
        <span class="n">loss</span><span class="o">=</span><span class="s1">&#39;categorical_crossentropy&#39;</span><span class="p">,</span>
        <span class="n">metrics</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;accuracy&#39;</span><span class="p">]</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="n">model</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">tensorflow</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">tf</span><span class="o">,</span><span class="w"> </span><span class="nn">time</span>

<span class="c1"># Forzar CPU</span>
<span class="k">with</span> <span class="n">tf</span><span class="o">.</span><span class="n">device</span><span class="p">(</span><span class="s1">&#39;/CPU:0&#39;</span><span class="p">):</span>
    <span class="n">model_cpu</span> <span class="o">=</span> <span class="n">build_fasttext_model</span><span class="p">()</span>
    <span class="n">t0</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
    <span class="n">history_cpu</span> <span class="o">=</span> <span class="n">model_cpu</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span>
        <span class="n">X_train_pad</span><span class="p">,</span> <span class="n">y_train_cat</span><span class="p">,</span>
        <span class="n">validation_data</span><span class="o">=</span><span class="p">(</span><span class="n">X_val_pad</span><span class="p">,</span> <span class="n">y_val_cat</span><span class="p">),</span>
        <span class="n">epochs</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
        <span class="n">batch_size</span><span class="o">=</span><span class="mi">64</span><span class="p">,</span>
        <span class="n">verbose</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">)</span>
    <span class="n">t1</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>

<span class="n">train_time_cpu</span> <span class="o">=</span> <span class="n">t1</span> <span class="o">-</span> <span class="n">t0</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;âœ… Entrenamiento CPU completado en </span><span class="si">{</span><span class="n">train_time_cpu</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> s&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Epoch 1/10
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>WARNING: All log messages before absl::InitializeLog() is called are written to STDERR
I0000 00:00:1762461589.734244  279001 gpu_device.cc:2019] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 5078 MB memory:  -&gt; device: 0, name: NVIDIA GeForce RTX 5070 Laptop GPU, pci bus id: 0000:01:00.0, compute capability: 12.0
/home/nicoplayz/tf312/lib/python3.12/site-packages/keras/src/layers/core/embedding.py:97: UserWarning: Argument `input_length` is deprecated. Just remove it.
  warnings.warn(
2025-11-06 15:39:50.988920: I external/local_xla/xla/service/service.cc:153] XLA service 0x748e0400a680 initialized for platform Host (this does not guarantee that XLA will be used). Devices:
2025-11-06 15:39:50.988940: I external/local_xla/xla/service/service.cc:161]   StreamExecutor device (0): Host, Default Version
2025-11-06 15:39:51.045008: I tensorflow/compiler/mlir/tensorflow/utils/dump_mlir_util.cc:269] disabling MLIR crash reproducer, set env var `MLIR_CRASH_REPRODUCER_DIRECTORY` to enable.
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span><span class=" -Color -Color-Bold">19/30</span> <span class=" -Color -Color-Green">â”â”â”â”â”â”â”â”â”â”â”â”</span><span class=" -Color -Color-White">â”â”â”â”â”â”â”â”</span> <span class=" -Color -Color-Bold">0s</span> 6ms/step - accuracy: 0.0894 - loss: 3.1754
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>I0000 00:00:1762461591.496705  279306 device_compiler.h:196] Compiled cluster using XLA!  This line is logged at most once for the lifetime of the process.
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span><span class=" -Color -Color-Bold">30/30</span> <span class=" -Color -Color-Green">â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”</span> <span class=" -Color -Color-Bold">2s</span> 20ms/step - accuracy: 0.1807 - loss: 3.1653 - val_accuracy: 0.2868 - val_loss: 3.1411
Epoch 2/10
<span class=" -Color -Color-Bold">30/30</span> <span class=" -Color -Color-Green">â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”</span> <span class=" -Color -Color-Bold">0s</span> 6ms/step - accuracy: 0.3750 - loss: 3.0739 - val_accuracy: 0.3407 - val_loss: 3.0038
Epoch 3/10
<span class=" -Color -Color-Bold">30/30</span> <span class=" -Color -Color-Green">â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”</span> <span class=" -Color -Color-Bold">0s</span> 6ms/step - accuracy: 0.4322 - loss: 2.8122 - val_accuracy: 0.3652 - val_loss: 2.7053
Epoch 4/10
<span class=" -Color -Color-Bold">30/30</span> <span class=" -Color -Color-Green">â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”</span> <span class=" -Color -Color-Bold">0s</span> 6ms/step - accuracy: 0.5084 - loss: 2.3778 - val_accuracy: 0.4755 - val_loss: 2.3141
Epoch 5/10
<span class=" -Color -Color-Bold">30/30</span> <span class=" -Color -Color-Green">â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”</span> <span class=" -Color -Color-Bold">0s</span> 6ms/step - accuracy: 0.6056 - loss: 1.9269 - val_accuracy: 0.5172 - val_loss: 1.9855
Epoch 6/10
<span class=" -Color -Color-Bold">30/30</span> <span class=" -Color -Color-Green">â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”</span> <span class=" -Color -Color-Bold">0s</span> 6ms/step - accuracy: 0.6712 - loss: 1.5767 - val_accuracy: 0.5588 - val_loss: 1.7792
Epoch 7/10
<span class=" -Color -Color-Bold">30/30</span> <span class=" -Color -Color-Green">â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”</span> <span class=" -Color -Color-Bold">0s</span> 6ms/step - accuracy: 0.7264 - loss: 1.3168 - val_accuracy: 0.5613 - val_loss: 1.6316
Epoch 8/10
<span class=" -Color -Color-Bold">30/30</span> <span class=" -Color -Color-Green">â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”</span> <span class=" -Color -Color-Bold">0s</span> 6ms/step - accuracy: 0.7558 - loss: 1.1177 - val_accuracy: 0.5980 - val_loss: 1.5203
Epoch 9/10
<span class=" -Color -Color-Bold">30/30</span> <span class=" -Color -Color-Green">â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”</span> <span class=" -Color -Color-Bold">0s</span> 6ms/step - accuracy: 0.7878 - loss: 0.9496 - val_accuracy: 0.6250 - val_loss: 1.4473
Epoch 10/10
<span class=" -Color -Color-Bold">30/30</span> <span class=" -Color -Color-Green">â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”</span> <span class=" -Color -Color-Bold">0s</span> 6ms/step - accuracy: 0.8288 - loss: 0.8098 - val_accuracy: 0.6348 - val_loss: 1.3843
âœ… Entrenamiento CPU completado en 4.12 s
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Verificar GPU disponible</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Dispositivos disponibles:&quot;</span><span class="p">,</span> <span class="n">tf</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">list_physical_devices</span><span class="p">(</span><span class="s1">&#39;GPU&#39;</span><span class="p">))</span>

<span class="c1"># Entrenamiento en GPU</span>
<span class="k">with</span> <span class="n">tf</span><span class="o">.</span><span class="n">device</span><span class="p">(</span><span class="s1">&#39;/GPU:0&#39;</span><span class="p">):</span>
    <span class="n">model_gpu</span> <span class="o">=</span> <span class="n">build_fasttext_model</span><span class="p">()</span>
    <span class="n">t0</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
    <span class="n">history_gpu</span> <span class="o">=</span> <span class="n">model_gpu</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span>
        <span class="n">X_train_pad</span><span class="p">,</span> <span class="n">y_train_cat</span><span class="p">,</span>
        <span class="n">validation_data</span><span class="o">=</span><span class="p">(</span><span class="n">X_val_pad</span><span class="p">,</span> <span class="n">y_val_cat</span><span class="p">),</span>
        <span class="n">epochs</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
        <span class="n">batch_size</span><span class="o">=</span><span class="mi">64</span><span class="p">,</span>
        <span class="n">verbose</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">)</span>
    <span class="n">t1</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>

<span class="n">train_time_gpu</span> <span class="o">=</span> <span class="n">t1</span> <span class="o">-</span> <span class="n">t0</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;âœ… Entrenamiento GPU completado en </span><span class="si">{</span><span class="n">train_time_gpu</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> s&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Dispositivos disponibles: [PhysicalDevice(name=&#39;/physical_device:GPU:0&#39;, device_type=&#39;GPU&#39;)]
Epoch 1/10
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-11-06 15:40:02.048308: I external/local_xla/xla/service/service.cc:153] XLA service 0x748e04dd5650 initialized for platform CUDA (this does not guarantee that XLA will be used). Devices:
2025-11-06 15:40:02.048331: I external/local_xla/xla/service/service.cc:161]   StreamExecutor device (0): NVIDIA GeForce RTX 5070 Laptop GPU, Compute Capability 12.0
I0000 00:00:1762461602.168842  279306 cuda_dnn.cc:530] Loaded cuDNN version 90800
2025-11-06 15:40:02.199229: W external/local_xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2025-11-06 15:40:02.199264: W external/local_xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2025-11-06 15:40:02.199270: W external/local_xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2025-11-06 15:40:02.199276: W external/local_xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2025-11-06 15:40:02.199282: W external/local_xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2025-11-06 15:40:02.199286: W external/local_xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2025-11-06 15:40:03.284899: I external/local_xla/xla/stream_executor/cuda/subprocess_compilation.cc:346] ptxas warning : Registers are spilled to local memory in function &#39;gemm_fusion_dot_345&#39;, 112 bytes spill stores, 112 bytes spill loads

2025-11-06 15:40:03.354823: I external/local_xla/xla/stream_executor/cuda/subprocess_compilation.cc:346] ptxas warning : Registers are spilled to local memory in function &#39;gemm_fusion_dot_345&#39;, 128 bytes spill stores, 128 bytes spill loads

2025-11-06 15:40:03.404479: I external/local_xla/xla/stream_executor/cuda/subprocess_compilation.cc:346] ptxas warning : Registers are spilled to local memory in function &#39;gemm_fusion_dot_345&#39;, 136 bytes spill stores, 136 bytes spill loads

2025-11-06 15:40:03.453215: I external/local_xla/xla/stream_executor/cuda/subprocess_compilation.cc:346] ptxas warning : Registers are spilled to local memory in function &#39;gemm_fusion_dot_376&#39;, 4 bytes spill stores, 4 bytes spill loads

2025-11-06 15:40:03.526378: I external/local_xla/xla/stream_executor/cuda/subprocess_compilation.cc:346] ptxas warning : Registers are spilled to local memory in function &#39;gemm_fusion_dot_376&#39;, 8 bytes spill stores, 8 bytes spill loads

2025-11-06 15:40:03.620984: I external/local_xla/xla/stream_executor/cuda/subprocess_compilation.cc:346] ptxas warning : Registers are spilled to local memory in function &#39;gemm_fusion_dot_209&#39;, 84 bytes spill stores, 84 bytes spill loads

2025-11-06 15:40:03.642410: I external/local_xla/xla/stream_executor/cuda/subprocess_compilation.cc:346] ptxas warning : Registers are spilled to local memory in function &#39;gemm_fusion_dot_345&#39;, 184 bytes spill stores, 184 bytes spill loads

2025-11-06 15:40:03.715132: I external/local_xla/xla/stream_executor/cuda/subprocess_compilation.cc:346] ptxas warning : Registers are spilled to local memory in function &#39;gemm_fusion_dot_421&#39;, 268 bytes spill stores, 268 bytes spill loads

2025-11-06 15:40:03.931728: I external/local_xla/xla/stream_executor/cuda/subprocess_compilation.cc:346] ptxas warning : Registers are spilled to local memory in function &#39;gemm_fusion_dot_209&#39;, 92 bytes spill stores, 92 bytes spill loads

2025-11-06 15:40:03.950789: I external/local_xla/xla/stream_executor/cuda/subprocess_compilation.cc:346] ptxas warning : Registers are spilled to local memory in function &#39;gemm_fusion_dot_376&#39;, 4 bytes spill stores, 4 bytes spill loads

2025-11-06 15:40:03.955495: I external/local_xla/xla/stream_executor/cuda/subprocess_compilation.cc:346] ptxas warning : Registers are spilled to local memory in function &#39;gemm_fusion_dot_376&#39;, 48 bytes spill stores, 48 bytes spill loads

2025-11-06 15:40:03.962258: I external/local_xla/xla/stream_executor/cuda/subprocess_compilation.cc:346] ptxas warning : Registers are spilled to local memory in function &#39;gemm_fusion_dot_376&#39;, 12 bytes spill stores, 12 bytes spill loads

2025-11-06 15:40:04.336436: I external/local_xla/xla/stream_executor/cuda/subprocess_compilation.cc:346] ptxas warning : Registers are spilled to local memory in function &#39;gemm_fusion_dot_442&#39;, 300 bytes spill stores, 300 bytes spill loads

2025-11-06 15:40:04.489151: I external/local_xla/xla/stream_executor/cuda/subprocess_compilation.cc:346] ptxas warning : Registers are spilled to local memory in function &#39;gemm_fusion_dot_209&#39;, 120 bytes spill stores, 120 bytes spill loads

2025-11-06 15:40:04.587687: I external/local_xla/xla/stream_executor/cuda/subprocess_compilation.cc:346] ptxas warning : Registers are spilled to local memory in function &#39;gemm_fusion_dot_376&#39;, 96 bytes spill stores, 96 bytes spill loads

2025-11-06 15:40:04.601785: I external/local_xla/xla/stream_executor/cuda/subprocess_compilation.cc:346] ptxas warning : Registers are spilled to local memory in function &#39;gemm_fusion_dot_421&#39;, 268 bytes spill stores, 268 bytes spill loads

2025-11-06 15:40:04.611313: I external/local_xla/xla/stream_executor/cuda/subprocess_compilation.cc:346] ptxas warning : Registers are spilled to local memory in function &#39;gemm_fusion_dot_442&#39;, 288 bytes spill stores, 288 bytes spill loads
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span><span class=" -Color -Color-Bold"> 1/30</span> <span class=" -Color -Color-White">â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”</span> <span class=" -Color -Color-Bold">2:02</span> 4s/step - accuracy: 0.0156 - loss: 3.1780
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-11-06 15:40:05.917143: W external/local_xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2025-11-06 15:40:05.917185: W external/local_xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2025-11-06 15:40:05.917191: W external/local_xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2025-11-06 15:40:05.917197: W external/local_xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2025-11-06 15:40:05.917202: W external/local_xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2025-11-06 15:40:05.917207: W external/local_xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2025-11-06 15:40:06.588116: I external/local_xla/xla/stream_executor/cuda/subprocess_compilation.cc:346] ptxas warning : Registers are spilled to local memory in function &#39;gemm_fusion_dot_202&#39;, 48 bytes spill stores, 48 bytes spill loads

2025-11-06 15:40:06.778396: I external/local_xla/xla/stream_executor/cuda/subprocess_compilation.cc:346] ptxas warning : Registers are spilled to local memory in function &#39;gemm_fusion_dot_209&#39;, 80 bytes spill stores, 80 bytes spill loads

2025-11-06 15:40:06.828884: I external/local_xla/xla/stream_executor/cuda/subprocess_compilation.cc:346] ptxas warning : Registers are spilled to local memory in function &#39;gemm_fusion_dot_376&#39;, 64 bytes spill stores, 64 bytes spill loads

2025-11-06 15:40:06.902851: I external/local_xla/xla/stream_executor/cuda/subprocess_compilation.cc:346] ptxas warning : Registers are spilled to local memory in function &#39;gemm_fusion_dot_209&#39;, 100 bytes spill stores, 100 bytes spill loads

2025-11-06 15:40:06.948239: I external/local_xla/xla/stream_executor/cuda/subprocess_compilation.cc:346] ptxas warning : Registers are spilled to local memory in function &#39;gemm_fusion_dot_376&#39;, 72 bytes spill stores, 72 bytes spill loads

2025-11-06 15:40:07.113120: I external/local_xla/xla/stream_executor/cuda/subprocess_compilation.cc:346] ptxas warning : Registers are spilled to local memory in function &#39;gemm_fusion_dot_209&#39;, 124 bytes spill stores, 124 bytes spill loads

2025-11-06 15:40:07.365301: I external/local_xla/xla/stream_executor/cuda/subprocess_compilation.cc:346] ptxas warning : Registers are spilled to local memory in function &#39;gemm_fusion_dot_376&#39;, 4 bytes spill stores, 4 bytes spill loads

2025-11-06 15:40:07.389006: I external/local_xla/xla/stream_executor/cuda/subprocess_compilation.cc:346] ptxas warning : Registers are spilled to local memory in function &#39;gemm_fusion_dot_209&#39;, 104 bytes spill stores, 104 bytes spill loads

2025-11-06 15:40:07.501265: I external/local_xla/xla/stream_executor/cuda/subprocess_compilation.cc:346] ptxas warning : Registers are spilled to local memory in function &#39;gemm_fusion_dot_345&#39;, 160 bytes spill stores, 160 bytes spill loads

2025-11-06 15:40:07.598244: I external/local_xla/xla/stream_executor/cuda/subprocess_compilation.cc:346] ptxas warning : Registers are spilled to local memory in function &#39;gemm_fusion_dot_376&#39;, 108 bytes spill stores, 108 bytes spill loads
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span><span class=" -Color -Color-Bold">30/30</span> <span class=" -Color -Color-Green">â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”</span> <span class=" -Color -Color-Bold">0s</span> 99ms/step - accuracy: 0.0975 - loss: 3.1727
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-11-06 15:40:09.255639: W external/local_xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2025-11-06 15:40:09.255680: W external/local_xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2025-11-06 15:40:09.910754: I external/local_xla/xla/stream_executor/cuda/subprocess_compilation.cc:346] ptxas warning : Registers are spilled to local memory in function &#39;gemm_fusion_dot_95&#39;, 80 bytes spill stores, 80 bytes spill loads

2025-11-06 15:40:09.959127: I external/local_xla/xla/stream_executor/cuda/subprocess_compilation.cc:346] ptxas warning : Registers are spilled to local memory in function &#39;gemm_fusion_dot_88&#39;, 48 bytes spill stores, 48 bytes spill loads

2025-11-06 15:40:09.965572: I external/local_xla/xla/stream_executor/cuda/subprocess_compilation.cc:346] ptxas warning : Registers are spilled to local memory in function &#39;gemm_fusion_dot_95&#39;, 148 bytes spill stores, 148 bytes spill loads

2025-11-06 15:40:09.971896: I external/local_xla/xla/stream_executor/cuda/subprocess_compilation.cc:346] ptxas warning : Registers are spilled to local memory in function &#39;gemm_fusion_dot_95&#39;, 92 bytes spill stores, 92 bytes spill loads

2025-11-06 15:40:09.992937: I external/local_xla/xla/stream_executor/cuda/subprocess_compilation.cc:346] ptxas warning : Registers are spilled to local memory in function &#39;gemm_fusion_dot_95&#39;, 92 bytes spill stores, 92 bytes spill loads
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span><span class=" -Color -Color-Bold">30/30</span> <span class=" -Color -Color-Green">â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”</span> <span class=" -Color -Color-Bold">10s</span> 192ms/step - accuracy: 0.1408 - loss: 3.1658 - val_accuracy: 0.2990 - val_loss: 3.1425
Epoch 2/10
<span class=" -Color -Color-Bold">30/30</span> <span class=" -Color -Color-Green">â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”</span> <span class=" -Color -Color-Bold">0s</span> 5ms/step - accuracy: 0.4391 - loss: 3.0820 - val_accuracy: 0.4093 - val_loss: 3.0201
Epoch 3/10
<span class=" -Color -Color-Bold">30/30</span> <span class=" -Color -Color-Green">â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”</span> <span class=" -Color -Color-Bold">0s</span> 5ms/step - accuracy: 0.5173 - loss: 2.8442 - val_accuracy: 0.4583 - val_loss: 2.7292
Epoch 4/10
<span class=" -Color -Color-Bold">30/30</span> <span class=" -Color -Color-Green">â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”</span> <span class=" -Color -Color-Bold">0s</span> 4ms/step - accuracy: 0.5441 - loss: 2.3958 - val_accuracy: 0.5049 - val_loss: 2.2951
Epoch 5/10
<span class=" -Color -Color-Bold">30/30</span> <span class=" -Color -Color-Green">â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”</span> <span class=" -Color -Color-Bold">0s</span> 4ms/step - accuracy: 0.5998 - loss: 1.9114 - val_accuracy: 0.5392 - val_loss: 1.9567
Epoch 6/10
<span class=" -Color -Color-Bold">30/30</span> <span class=" -Color -Color-Green">â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”</span> <span class=" -Color -Color-Bold">0s</span> 4ms/step - accuracy: 0.6717 - loss: 1.5570 - val_accuracy: 0.5613 - val_loss: 1.7589
Epoch 7/10
<span class=" -Color -Color-Bold">30/30</span> <span class=" -Color -Color-Green">â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”</span> <span class=" -Color -Color-Bold">0s</span> 3ms/step - accuracy: 0.7143 - loss: 1.3095 - val_accuracy: 0.5858 - val_loss: 1.6151
Epoch 8/10
<span class=" -Color -Color-Bold">30/30</span> <span class=" -Color -Color-Green">â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”</span> <span class=" -Color -Color-Bold">0s</span> 3ms/step - accuracy: 0.7605 - loss: 1.1083 - val_accuracy: 0.6005 - val_loss: 1.5119
Epoch 9/10
<span class=" -Color -Color-Bold">30/30</span> <span class=" -Color -Color-Green">â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”</span> <span class=" -Color -Color-Bold">0s</span> 4ms/step - accuracy: 0.7978 - loss: 0.9403 - val_accuracy: 0.6152 - val_loss: 1.4437
Epoch 10/10
<span class=" -Color -Color-Bold">30/30</span> <span class=" -Color -Color-Green">â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”</span> <span class=" -Color -Color-Bold">0s</span> 3ms/step - accuracy: 0.8382 - loss: 0.7948 - val_accuracy: 0.6324 - val_loss: 1.3878
âœ… Entrenamiento GPU completado en 11.04 s
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">sklearn.metrics</span><span class="w"> </span><span class="kn">import</span> <span class="n">accuracy_score</span><span class="p">,</span> <span class="n">precision_score</span><span class="p">,</span> <span class="n">recall_score</span><span class="p">,</span> <span class="n">f1_score</span><span class="p">,</span> <span class="n">roc_auc_score</span>

<span class="k">def</span><span class="w"> </span><span class="nf">evaluar_modelo</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">X_test_pad</span><span class="p">,</span> <span class="n">y_test</span><span class="p">,</span> <span class="n">y_test_cat</span><span class="p">,</span> <span class="n">nombre</span><span class="p">,</span> <span class="n">train_time</span><span class="p">):</span>
    <span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span><span class="o">,</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span><span class="o">,</span><span class="w"> </span><span class="nn">time</span>

    <span class="n">t0</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
    <span class="n">y_pred_proba</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test_pad</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">y_pred</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">y_pred_proba</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">t1</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>

    <span class="n">accuracy</span>  <span class="o">=</span> <span class="n">accuracy_score</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)</span>
    <span class="n">precision</span> <span class="o">=</span> <span class="n">precision_score</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">,</span> <span class="n">average</span><span class="o">=</span><span class="s1">&#39;macro&#39;</span><span class="p">,</span> <span class="n">zero_division</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">recall</span>    <span class="o">=</span> <span class="n">recall_score</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">,</span> <span class="n">average</span><span class="o">=</span><span class="s1">&#39;macro&#39;</span><span class="p">,</span> <span class="n">zero_division</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">f1</span>        <span class="o">=</span> <span class="n">f1_score</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">,</span> <span class="n">average</span><span class="o">=</span><span class="s1">&#39;macro&#39;</span><span class="p">,</span> <span class="n">zero_division</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">roc_auc</span>   <span class="o">=</span> <span class="n">roc_auc_score</span><span class="p">(</span><span class="n">y_test_cat</span><span class="p">,</span> <span class="n">y_pred_proba</span><span class="p">,</span> <span class="n">multi_class</span><span class="o">=</span><span class="s1">&#39;ovr&#39;</span><span class="p">,</span> <span class="n">average</span><span class="o">=</span><span class="s1">&#39;macro&#39;</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">ðŸ“ˆ </span><span class="si">{</span><span class="n">nombre</span><span class="si">}</span><span class="s2">:&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;   Accuracy:  </span><span class="si">{</span><span class="n">accuracy</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;   Precision: </span><span class="si">{</span><span class="n">precision</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;   Recall:    </span><span class="si">{</span><span class="n">recall</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;   F1:        </span><span class="si">{</span><span class="n">f1</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;   ROC-AUC:   </span><span class="si">{</span><span class="n">roc_auc</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;   Tiempo entrenamiento: </span><span class="si">{</span><span class="n">train_time</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> s&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;   Tiempo evaluaciÃ³n:   </span><span class="si">{</span><span class="n">t1</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">t0</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> s&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">([{</span>
        <span class="s2">&quot;Modelo&quot;</span><span class="p">:</span> <span class="n">nombre</span><span class="p">,</span>
        <span class="s2">&quot;Accuracy&quot;</span><span class="p">:</span> <span class="n">accuracy</span><span class="p">,</span>
        <span class="s2">&quot;Precision (Macro)&quot;</span><span class="p">:</span> <span class="n">precision</span><span class="p">,</span>
        <span class="s2">&quot;Recall (Macro)&quot;</span><span class="p">:</span> <span class="n">recall</span><span class="p">,</span>
        <span class="s2">&quot;F1-Score (Macro)&quot;</span><span class="p">:</span> <span class="n">f1</span><span class="p">,</span>
        <span class="s2">&quot;ROC-AUC (OvR)&quot;</span><span class="p">:</span> <span class="n">roc_auc</span><span class="p">,</span>
        <span class="s2">&quot;Train Time (s)&quot;</span><span class="p">:</span> <span class="n">train_time</span><span class="p">,</span>
        <span class="s2">&quot;Eval Time (s)&quot;</span><span class="p">:</span> <span class="n">t1</span> <span class="o">-</span> <span class="n">t0</span>
    <span class="p">}])</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># ======================================================</span>
<span class="c1"># ðŸ§  Evaluar modelo CPU</span>
<span class="c1"># ======================================================</span>
<span class="k">with</span> <span class="n">tf</span><span class="o">.</span><span class="n">device</span><span class="p">(</span><span class="s1">&#39;/CPU:0&#39;</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;âš™ï¸ Evaluando modelo CPU...&quot;</span><span class="p">)</span>
    <span class="n">df_cpu</span> <span class="o">=</span> <span class="n">evaluar_modelo</span><span class="p">(</span>
        <span class="n">model_cpu</span><span class="p">,</span>
        <span class="n">X_test_pad</span><span class="p">,</span>
        <span class="n">y_test</span><span class="p">,</span>
        <span class="n">y_test_cat</span><span class="p">,</span>
        <span class="s2">&quot;FastText CPU (preentrenado)&quot;</span><span class="p">,</span>
        <span class="n">train_time_cpu</span>
    <span class="p">)</span>

<span class="c1"># ======================================================</span>
<span class="c1"># âš¡ Evaluar modelo GPU</span>
<span class="c1"># ======================================================</span>
<span class="k">with</span> <span class="n">tf</span><span class="o">.</span><span class="n">device</span><span class="p">(</span><span class="s1">&#39;/GPU:0&#39;</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;âš™ï¸ Evaluando modelo GPU...&quot;</span><span class="p">)</span>
    <span class="n">df_gpu</span> <span class="o">=</span> <span class="n">evaluar_modelo</span><span class="p">(</span>
        <span class="n">model_gpu</span><span class="p">,</span>
        <span class="n">X_test_pad</span><span class="p">,</span>
        <span class="n">y_test</span><span class="p">,</span>
        <span class="n">y_test_cat</span><span class="p">,</span>
        <span class="s2">&quot;FastText GPU (preentrenado)&quot;</span><span class="p">,</span>
        <span class="n">train_time_gpu</span>
    <span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>âš™ï¸ Evaluando modelo CPU...

ðŸ“ˆ FastText CPU (preentrenado):
   Accuracy:  0.6078
   Precision: 0.6154
   Recall:    0.6022
   F1:        0.5983
   ROC-AUC:   0.9308
   Tiempo entrenamiento: 4.12 s
   Tiempo evaluaciÃ³n:   0.06 s
âš™ï¸ Evaluando modelo GPU...
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-11-06 15:45:06.766570: W external/local_xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2025-11-06 15:45:06.766606: W external/local_xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2025-11-06 15:45:07.185708: I external/local_xla/xla/stream_executor/cuda/subprocess_compilation.cc:346] ptxas warning : Registers are spilled to local memory in function &#39;gemm_fusion_dot_31&#39;, 12 bytes spill stores, 12 bytes spill loads

2025-11-06 15:45:07.284094: I external/local_xla/xla/stream_executor/cuda/subprocess_compilation.cc:346] ptxas warning : Registers are spilled to local memory in function &#39;gemm_fusion_dot_38&#39;, 80 bytes spill stores, 80 bytes spill loads

2025-11-06 15:45:07.288956: I external/local_xla/xla/stream_executor/cuda/subprocess_compilation.cc:346] ptxas warning : Registers are spilled to local memory in function &#39;gemm_fusion_dot_31&#39;, 48 bytes spill stores, 48 bytes spill loads

2025-11-06 15:45:07.386980: I external/local_xla/xla/stream_executor/cuda/subprocess_compilation.cc:346] ptxas warning : Registers are spilled to local memory in function &#39;gemm_fusion_dot_38&#39;, 72 bytes spill stores, 72 bytes spill loads

2025-11-06 15:45:07.468343: I external/local_xla/xla/stream_executor/cuda/subprocess_compilation.cc:346] ptxas warning : Registers are spilled to local memory in function &#39;gemm_fusion_dot_38&#39;, 120 bytes spill stores, 120 bytes spill loads

2025-11-06 15:45:07.469024: I external/local_xla/xla/stream_executor/cuda/subprocess_compilation.cc:346] ptxas warning : Registers are spilled to local memory in function &#39;gemm_fusion_dot_38&#39;, 92 bytes spill stores, 92 bytes spill loads
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>ðŸ“ˆ FastText GPU (preentrenado):
   Accuracy:  0.5931
   Precision: 0.6202
   Recall:    0.5902
   F1:        0.5971
   ROC-AUC:   0.9295
   Tiempo entrenamiento: 11.04 s
   Tiempo evaluaciÃ³n:   1.54 s
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df_cpu</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s2">&quot;metrics_fasttext_CPU.csv&quot;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf-8-sig&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;âœ… Resultados CPU guardados en: metrics_fasttext_CPU.csv&quot;</span><span class="p">)</span>

<span class="n">df_gpu</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s2">&quot;metrics_fasttext_GPU.csv&quot;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf-8-sig&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;âœ… Resultados GPU guardados en: metrics_fasttext_GPU.csv&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>âœ… Resultados CPU guardados en: metrics_fasttext_CPU.csv
âœ… Resultados GPU guardados en: metrics_fasttext_GPU.csv
</pre></div>
</div>
</div>
</div>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "tf312"
        },
        kernelOptions: {
            name: "tf312",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'tf312'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="DistilBERT.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Modelo: Transformers (DistilBERT o RoBERTa)</p>
      </div>
    </a>
    <a class="right-next"
       href="Resultados.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">InterpretaciÃ³n general</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#">W2V + BilSTM</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#cnn-1d-con-embeddings">CNN-1D con Embeddings</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#tf-idf-xgboost-con-gpu">TF-IDF + XGBoost con GPU</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#fast-text-con-entrenamiento-local">FAST TEXT con entrenamiento local</a></li>
</ul>

  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By NicolÃ¡s RodrÃ­guez
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      Â© Copyright 2022.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
<div class="extra_footer">
  <p>Â© 2025 NicolÃ¡s RodrÃ­guez. Proyecto Jarvis Calling NLP Contest.</p>
</div>
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b"></script>
<script src="_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>